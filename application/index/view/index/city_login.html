<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>后台合伙人登录</title>
    <link rel="stylesheet" href="__STATIC__/index/css/common.css">
    <link rel="stylesheet" href="__STATIC__/index/css/swiper-4.3.5.min.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/upfile/css/index.css" />
    <!-- 数字验证码 样式 -->
    <link rel="stylesheet" href="__STATIC__/index/thirdpart/css/verify.css">
    <script src="__STATIC__/index/js/intlTelInput.min.js"></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/upfile/css/index.css" />
    <style>
        html,body{height: 100%;}
        body{position: relative;}
        .partner-info-container{width: 1350px; margin: 0 auto;}
        .city-title{display: flex;justify-content: space-between;padding: 10px 0;}
        .title-l{font-weight: 700;font-size: 16px;}
        .city-apply{line-height: 23px;margin-right: 15px;}
        .city-apply a{color: #333333;}
        .city-login{color: #fff;background-color:rgb(152,145,52);padding:0 10px;line-height: 23px;border-radius: 3px;}
        .signin-content-inner .signin-form-wrap{width: 350px; margin: 0 auto;border: 1px solid rgb(121,121,121);border-radius: 10px;padding: 30px;}
        .signin-content-inner .section-group{border-bottom: 1px solid #e5e5e5; display: flex; margin-bottom: 30px; align-items: center; height: 40px;}
        .signin-content-inner .section-group .form-label{display: inline-block; width: 100px; font-size: 14px; color: #515151; font-weight: 700;}
        .signin-content-inner .section-group .form-input-wrap{width: 250px; position: relative;}
        .section-group .form-input-wrap input{border: 0; font-size: 14px;background-color: rgb(244,244,244);}
        .intl-tel-input.separate-dial-code .selected-flag{background-color: transparent !important;}
        .section-group .form-input-wrap .pw-icon{position: absolute; right: 20px; top: 0; width: 24px; height: 24px; background-color: #000; cursor: pointer; background: url(__STATIC__/index/img/icon1.png) no-repeat; background-size: 100%;}
        .section-group .form-input-wrap .pw-icon.pw-icon-show{background: url(__STATIC__/index/img/icon2.png) no-repeat; background-size: 100%;}
        .button-primary{display: block; margin-top: 30px; width: 350px; height: 45px; border: 0; outline: none; background-color: #38f; color: #fff; font-size: 16px; box-sizing: border-box; border-radius: 2px; cursor: pointer;}
        .forget-group{ margin-top: 20px;}
        .forget-group .forget-pw{float: right;}
        .forget-group a{color: #38f;}
        .copyright{text-align: center; margin-top: 50px;color: #515151;}
        .copyright a{color: #515151;}
        .qr-code-wrap{width: 350px; margin: 0 auto; text-align: center;}
        .varify-input-code{background-color: rgb(244,244,244);}
        .pay_main,.pay_bounced,.pay_bounced_kp{width: 100%;height: 100%;background-color: rgb(0,0,0, .5);position: absolute;top: 0;}
        .pay_box{width: 60%;margin: 10% auto;background: #fff;padding: 30px 40px;}
        .pay_table table{width:100%;margin:0 auto;text-align: center;border: 1px solid rgb(168,221,255);}
        .pay_table table thead{background-color: rgb(207,236,255);line-height: 50px;border-bottom: 1px solid rgb(168,221,255);}
        .pay_table table tbody tr{height: 100px;}
        .c_city{font-size: 21px;line-height: 50px;}
        .city_n{color:red;font-weight: 700;}
        .pay_k{display:flex;flex-direction: column;justify-content: flex-end; margin-top: 50px;text-align: right;}
        .pay_t{width: 400px;display: inline-block;font-size: 16px;border: 1px solid red;line-height: 70px;background-color: rgb(244,251,255);}
        .pay_mon{font-size: 25px;padding-right: 10px;font-weight: 700;color: rgb(255,102,0);}
        .pay_btn{width: 150px;text-align: center;background-color: red;color: #fff;font-size: 20px;line-height: 40px;padding: 7px 30px;cursor: pointer;}
        .th_one{text-align: left;width: 35%;}
        .tr_one{text-align: left;padding-left: 12%;}
        .pay_invoice{display: flex;justify-content: space-between;margin: 10px;}
        .tips{text-decoration:line-through;color: rgb(174,174,174);}
        .pay_bounced_x{width: 30%;margin:10% auto;background-color: #fff;border-radius: 10px;padding: 15px 30px;}
        .close_box{display: flex;justify-content: space-between;font-size: 30px;border-bottom: 1px solid black;}
        .close_title,.close_title_kp{font-weight: 700;}
        .close,.close_kp{cursor: pointer;}
        .pay_img{text-align:center;}
        .pay_img img{width: 50px;height: 50px;}
        .scan-way{text-align: center;}
        .scan-way .scan-tip{font-size: 28px; color: #333;}
        .scan-way .support{margin: 10px 0;}
        .payment{line-height: 50px;border-bottom: 1px solid rgb(188,188,188);font-size: 20px;margin-bottom: 20px;}
        .w_l{width: 120px;display:inline-block;}
        .pay_money{font-size: 26px;color: rgb(255,102,0);}
        .wx_pay,.ali_pay {cursor: pointer;}
        .offline_pay{font-size: 21px;color: rgb(174,174,174);line-height: 38px;}
        .s_t{width: 130px;display:inline-block;text-align: right;}
        .offline_main{background-color: rgb(242,242,242);}
        .com_name{color: black;}
        .off_input{margin-top: 15px;}
        .off_input input {width: 100%;border-radius: 3px;border: 1px solid rgb(188,188,188);height: 40px;}
        .btn_b{text-align:right;}
        .off_btn{color: #fff;background-color: rgb(22,155,213);border-radius: 3px;font-size: 14px;width: 250px;text-align: center;display: inline-block;cursor: pointer;}
        .line{height: 1px;background-color: rgb(188,188,188);margin: 15px 0;}
        .upimg-div .up-section {width: 100%; height: 150px;}
        .img-box {padding-left: 14%;}
        .pz_title,.pz_title_two{text-align: center;color: rgb(134,134,134);font-size: 21px;line-height: 70px;}
        .hk_zh{font-size: 20px;color: rgb(134,134,134);}
        .hk_zh input{border: 0;}
        .hk_btn,.hk_btn_yz{width: 100px;text-align: center;background-color: rgb(22,155,213);color: #fff;border-radius: 3px;line-height: 35px;cursor: pointer;}
        .address,.phone_number{font-size: 16px;}
        .invoice_box{line-height: 55px;font-size:20px;}
        .inp_wid{width: 80%;}
        .m_r{margin-right: 100px;}
        .m_r_x{margin-right: 140px;}
        .tishi{color: red;font-size: 14px;}
        .kp_btn{width: 150px;margin: 0 auto;text-align: center;color: #fff;background-color: rgb(22,155,213);border-radius: 4px;line-height: 45px;cursor: pointer;}
        .close_order{margin: 15%;cursor: pointer;color: rgb(0,178,255);}
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="header">
            <div class="header-container">
                <div class="header-section logo">
                    <!-- <div class="logo-container">
                        <img src="__STATIC__/index/img/logo.png" width="50" height="40">
                    </div>
                    <span>宣铭科技</span> -->
                    <img src="__STATIC__/index/img/logo1.png" height="70">
                    <!--<p style="font-size:35px;font-weight:bolder;margin-left:7px;">智慧茶仓</p>-->
                </div>
                <div class="header-section nav">
                    <ul class="nav-ul clearfix">
                        <li class="nav-li"><a href="javascript:;" class="nav-a">首页</a></li>
                        <li class="nav-li"><a href="javascript:;" class="nav-a">智慧茶仓</a></li>
                        <li class="nav-li"><a href="javascript:;" class="nav-a nav-on">城市合伙人</a></li>
                        <li class="nav-li"><a href="javascript:;" class="nav-a">关于我们</a></li>
                    </ul>
                </div>
                {if !empty($phone_num)}
                <div class="header-section loaded-common">
                    <div class="loaded-inner">
                        <span class="loaded-icon"></span>
                        <a href="javascript:;" target="_blank">
                            <span class="loaded-mobile">{$phone_num}</span>
                        </a>
                        <i class="caret"></i>
                        <ul class="loaded-menu">
                            <li><a href="javascript:;" class="backstage">进入后台</a></li>
                            <li><a href="javascript:;" class="logout">退出登录</a></li>
                        </ul>
                    </div>
                </div>
                {else}
                <div class="header-section login">
                    <a href="javascript:;" class="sign-in">登录</a>
                    <a href="javascript:;" class="register">注册</a>
                </div>
                {/if}
            </div>
        </div>

        <div class="partner-info">
            <div class="partner-info-container">
                <div class="city-title">
                    <div class="title-l">服务窗口</div>
                    <div style="flex:1;"></div>
                    <div class="city-apply">
                        <a href="partner.html">申请城市合伙人</a>
                    </div>
                    <div class="city-login">合伙人后台登录</div>
                </div>
                <div class="partner-info-banner">
                    <img src="__STATIC__/index/img/u232.png" width="1350" height="210">
                </div>
                <div style="margin: 30px auto;text-align: center;font-size: 30px;font-weight: 700;">
                    合伙人后台登录
                </div>
                <!-- 登录框 -->
                <div class="signin-content-inner">
                    <div class="signin-form-wrap">
                        <div class="section-group phone-wrap">
                            <label class="form-label">手机号码</label>
                            <div class="form-input-wrap">
                                <input type="text" id="phone" name="phone" placeholder="注册时填写的手机号">
                            </div>
                        </div>
                        <div class="section-group password-wrap">
                            <label class="form-label">设置密码</label>
                            <div class="form-input-wrap">
                                <input type="password" id="password" name="password" placeholder="请输入密码">
                                <span class="pw-icon"></span>
                            </div>
                        </div>
                        <!-- 数字验证码 -->
                        <div class="section-group">
                            <label class="form-label">验证码</label>
                            <div class="num" style="height: 40px">
                                <div id="imgVer"></div>
                            </div>
                        </div>
                        <button type="submit" id="sub" class="button-primary">登录</button>
                        <div class="forget-group">
                            还没账号？<a href="partner">立即申请成为城市合伙人</a>
                            <a href="city_forget" class="forget-pw">忘记密码</a>
                        </div>
                    </div>
                    <div class="qr-code-wrap" style="display: none;">
                        <img src="__STATIC__/index/img/qrcode.png" width="260" height="260">
                    </div>
                </div>
                <div style="text-align: center;margin-top:15px;font-size:12px;color:rgb(121,121,121);">
                    © 2016-2019 宣铭科技版权所有
                </div>

            </div>
        </div>
    </div>
    <!-- 订单弹框 -->
    <div class="pay_main" style="display: none;" id="app">
    </div>

    <!-- 开票弹框 -->
    <div class="pay_bounced_kp" style="display: none;">
        <div class="pay_bounced_x">
            <div class="close_box">
                <div class="close_title_kp">我要开票</div>
                <div class="close_kp">×</div>
            </div>
            <div class="invoice_box">
                <form id="invoice_sq" onsubmit="return false" action="##" method="post" enctype="multipart/form-data">
                <div>开票金额：<span style="font-size: 26px;color: rgb(255,102,0);">￥</span><span class="pay_money">9023</span></div>
                <input type="text" name="user_id" style="display: none">
                <input type="text" name="no" style="display: none">
                <input type="number" name="price" style="display: none">
                <div>发票类型：<input type="radio" name="type" value="1" checked><label class="m_r_x">企业</label><input type="radio" name="type" value="2"><label>个人</label></div>
                <div>发票样式：<input type="radio" name="status" value="1" checked><label class="m_r_x">电子</label><input type="radio" name="status" value="2"><label>纸质</label></div>
                <div>邮箱地址：<input class="inp_wid" type="email" name="email" placeholder="  如需电子发票请填写您的邮箱"></div>
                <div>发票抬头：<input class="inp_wid" type="text" name="rise" placeholder="  请填写公司名/个人姓名"></div>
                <div>发票税号：<input class="inp_wid" type="text" name="duty" placeholder="  请填写企业税号/个人无需提供税号"></div>
                <div>邮寄详情：<span class="address"></span></div>
                <div>手机号码：<span class="phone_number"></span></div>
                <input type="text" name="address" style="display: none">
                <input type="number" name="phone" style="display: none">
                <div>发票种类：<input type="radio" name="invoiceLine" value="p" checked><label class="m_r">普通发票</label><input type="radio" name="invoiceLine" value="s"><label>增值税发票</label></div>
                <div><span class="tishi">温馨提示：请确认好开票信息，发票一经开出后，不再重开！</span></div>
                <div class="line"></div>
                <div class="kp_btn">确定</div>
                </form>
            </div>
        </div>
    </div>
   
    <!-- 支付弹框 -->
    <div class="pay_bounced"  style="display: none;">
        <div class="pay_bounced_x">
            <div class="close_box">
                <div class="close_title">选择支付方式</div>
                <div class="close">×</div>
            </div>
            <div class="online_pay" >
                <div class="payment">
                    <div><span class="w_l">支付金额：</span><span style="font-size: 26px;color: rgb(255,102,0);">￥</span><span class="pay_money">9023</span></div>
                    <div><span class="w_l">支付方式：</span><input type="radio" name="pay" checked><label>扫码支付</label></div>
                    <div><span class="w_l"></span><input type="radio" name="pay" id="offlinePay" onchange="changeNatureItem(this.id)"><label>汇款支付</label></div>
                </div>
                <div class="scan-way">
                    <div class="code-box">
                        <img id="payImg" src="" width="200" height="200">
                    </div>
                    <div class="support">
                        <span>
                            <input type="radio" name='pay_f' checked>
                            <img src="__STATIC__/admin/common/img/g3.png" width="32" height="32">
                            <span>微信支付</span>
                        </span>
                        <span class="ali_pay">
                            <input type="radio" name='pay_f'>
                            <img src="__STATIC__/admin/common/img/g4.png" width="32" height="32">
                            <span>支付宝</span>
                        </span>
                    </div>
                    <p class="scan-tip">扫一扫完成支付</p>
                </div>
            </div>
            <div class="offline_pay"  style="display: none;">
                <div>您需汇款<span style="font-size: 26px;color: rgb(255,102,0);">￥</span><span class="pay_money">9,023</span>至以下官方账户，汇款成功后请填写相关凭证</div>
                <div class="offline_main">
                    <div><span class="s_t">官方开户名：</span><span class="com_name">北京宣铭科技有限公司</span></div>
                    <div><span class="s_t">官方开户行：</span><span class="com_name">北京农村商业银行股份有限公司马连道支行</span></div>
                    <div><span class="s_t">官方账户：</span><span class="com_name">0203210103000015884</span></div>
                </div>
                <div class="line"></div>
                <div class="off_input">
                    <input type="number" name="hk_num" id="hk_num" placeholder="请输入您的汇款账号">
                </div>
                <div class="btn_b">
                    <span class="off_btn">已转账汇款，我要上传凭证</span>
                </div>
            </div>
            <div class="offline_pz" style="display: none;">
                <form id="hkPz" onsubmit="return false" action="##" method="post" enctype="multipart/form-data">
                    <div class="pz_title">请拍照上传您的汇款单，作为凭证</div>
                    <input type="number" name="order_price" style="display: none;">
                    <div style="margin: 0 auto;">
                        <div class="img-box">
                            <section class=" img-section">
                                <div class="z_photo upimg-div clear">
                                    <section class="z_file fl" style="width: 100%;height: 150px;">
                                        <img src="http://teahouse.siring.cn/un211.jpg" class="add-img company-item"
                                            style="width:100%;height: 150px;">
                                        <input type="file" name="payment_document" id="file1" class="file" value=""
                                            accept="image/jpg,image/jpeg,image/png,image/bmp" data-id="1" style="height: 150px;" />
                                    </section>
                                </div>
                            </section>
                        </div>
                        <aside class="mask works-mask">
                            <div class="mask-content">
                                <p class="del-p ">您确定要删除作品图片吗？</p>
                                <p class="check-p"><span class="del-com wsdel-ok">确定</span><span class="wsdel-no">取消</span></p>
                            </div>
                        </aside>
                    </div>
                    <div class="line"></div>
                    <input type="text" name="order_number" id="orderNumber" style="display: none;">
                    <div style="display: flex;">
                        <div class="hk_zh">汇款账号： <input type="number" name="remittance_account" id="hkZh" value="47474747" readonly></div>
                        <div style="flex:1;"></div>
                        <div class="hk_btn">确定</div>
                    </div>
                </form>
            </div>
            <div class="pz_yz" style="display: none;">
                <div class="pz_title_two">您的汇款凭证已提交，我们将在3个工作日内审核完毕</div>
                <div style="margin: 0 auto;text-align: center;"><img src="__STATIC__/index/img/u232.png" alt="" id="pz_img" style="width: 250px;height:150px;"></div>
                <div class="line"></div>
                <div style="display: flex;">
                    <div class="hk_zh">汇款账号： <input type="number" name="hk_account" id="hkAccount" value="" readonly></div>
                    <div style="flex:1;"></div>
                    <div class="hk_btn_yz" style="display: none;">我要再次付款</div>
                </div>
            </div>
        </div>
    </div>
    
    

    <script src="__STATIC__/index/js/jquery.js"></script>
    <script src="__STATIC__/index/js/common.js"></script>
    <script src="__STATIC__/index/js/layer/layer.js"></script>
     <!--数字验证-->
     <script src="__STATIC__/index/thirdpart/js/swiper-4.3.5.min.js"></script>
    <script src="__STATIC__/index/thirdpart/js/verify.js"></script>
    <script type="text/javascript " src="__STATIC__/admin/common/upfile/js/imgUp.js"></script>

    <script>
        //开票
        function makeInvoice(user_id) {
            $.ajax({
                url: "city/mailing_address",
                type: "POST",
                data: {"user_id": user_id},
                success: (res)=> {
                    var data = res.data;
                    if(res.code == 1) {
                        var address = data.post_address_one + data.post_address_two + data.post_address_three + data.detail + "（" + data.user_name + " 收）";
                        $("input[name=phone]").val(data.phone_number);
                        $("input[name=address]").val(address);
                        $('.address').text(address);
                        $('.phone_number').text(data.phone_number);
                        $('.pay_bounced_kp').show();
                    }
                },
                error: (e) => {console.log(e)}
            })
        }
        //确定开票
        $(".kp_btn").click(function() {
            let datas = new FormData(document.getElementById("invoice_sq"));
            let price = datas.get("price"), invoiceLine = datas.get("invoiceLine"), poundage = 0;
            $.ajax({
                    url: "city/cityOrderReceipt",
                    type: "POST",
                    dataType: "json",//预期服务器返回的数据类型
                    data: datas,
                    contentType: false, //不设置内容类型
                    processData: false, //不处理数据
                    success: (res) => {
                        layer.msg(res.msg);
                        if(res.code == 1) {
                            if(invoiceLine == "p") {
                                poundage = (Number(price) * 0.03).toFixed(2);
                            } else {
                                poundage = (Number(price) * 0.06).toFixed(2);
                            }
                            price = Number(price) + Number(poundage);
                            $(".pay_money").text(price);
                            $(".pay_mon").text("￥"+price);
                            $(".poundage").text(poundage);
                            $(".pay_money").data("money", price);
                            $('.pay_btn').data("money", price);
                            $("input[name=invoice]").prop('checked',true);
                            $("input[name=order_price]").val(price);//凭证金额
                            $(".pay_bounced_kp").hide();
                        } else {
                            $("input[name=invoice]").prop('checked',false);
                        }
                    },
                    error: (e) => {
                        console.log(e)
                    }
            })
        })
        //确定上传凭证
        $(".hk_btn").click(function() {
           let datas = new FormData(document.getElementById("hkPz"));
            $.ajax({
                    url: "city/payment_image",
                    type: "POST",
                    dataType: "json",//预期服务器返回的数据类型
                    data: datas,
                    contentType: false, //不设置内容类型
                    processData: false, //不处理数据
                    success: (res) => {
                        $(".pz_title").text("您的汇款凭证已提交，我们将在3个工作日内审核完毕");
                        $(".hk_btn").hide();
                        layer.msg(res.msg);
                    },
                    error: (e) => {
                        console.log(e)
                    }
                })
        });
        //带账号到上传凭证页面
        $('.off_btn').add(".hk_btn_yz").click(function(){
            $('.offline_pay').hide();
            $('.online_pay').hide();
            $('.pz_yz').hide();
            $('.offline_pz').show();
            $('.close_title').text("城市合伙人汇款凭证");
            $("#hkZh").val($("#hk_num").val());
        })
        //支付方式选择线下
        function changeNatureItem(id) {
            if (id == 'offlinePay') {
                $('.offline_pay').show();
                $('.online_pay').hide();
                $('.close_title').text("城市合伙人汇款");
                // var pay_money =  $(this).data("money");
                // $(".pay_money").text(pay_money);
            }
        }
        

        $(".close").click(function () {
            $(".pay_bounced").hide();
        })
        $("#app").on("click", ".close_order" ,function() {
            $("#app").hide();
        })
        $(".close_kp").click(function () {
            $(".pay_bounced_kp").hide();
            $("input[name=invoice]").prop('checked',false);
        })

        //时间转换
        function formatDate(inputTime) {
        var date = new Date(inputTime * 1000);
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? ('0' + m) : m;
        var d = date.getDate();
        d = d < 10 ? ('0' + d) : d;
        var h = date.getHours();
        h = h < 10 ? ('0' + h) : h;
        var minute = date.getMinutes();
        var second = date.getSeconds();
        minute = minute < 10 ? ('0' + minute) : minute;
        second = second < 10 ? ('0' + second) : second;
        return y  + m +   d ;
        }

        // 数字验证码 init
   
        $('#imgVer').codeVerify({
           type: 2,
           figure: 5,	//位数，仅在type=2时生效
           arith: 0,	//算法，支持加减乘，不填为随机，仅在type=2时生效
           width: '115px',
           height: '40px',
           fontSize: '20px',
           btnId: 'sub',
           ready: function () {
                       },
           success: function (e) {
               
               setTimeout(function(){
                    statusLog == 1 ? location.href = 'city/logCityTenantDetail' : '';
                }, 1000);
           },
           error: function () {
            layer.msg('验证码不匹配！');
           }
       });
       document.onkeydown = function(e){
            if(e.keyCode == 13){
                $('.button-primary').click();
            }
        }
       //登录
       var statusLog = null;
        $('.button-primary').click(function () {
            var $phone = $('#phone').val(),
                $password = $('#password').val();
            if ($phone !== '' && $password !== '') {
                $.ajax({
                    url: 'city/apply_login',
                    type: 'POST',
                    dataType: 'JSON',
                    data: {
                        "User": {
                            "phone_number": $phone,
                            "password": $password
                        }
                    },
                    success: function (res) {
                        statusLog = res.code;
                        if (res.code == 1) {
                            //$(".num").css({
                            //  "display":"block"
                            //})
                            // layer.msg(res.info);
                            layer.msg('登录成功');
                            myEvent.setCookie(btoa('phone'), btoa($phone), 7); //保存帐号到cookie，有效期7天
                            myEvent.setCookie(btoa('password'), btoa($password), 7); //保存帐号到cookie，有效期7天
                            // setTimeout(function(){
                            //     location.href = 'my_shop';
                            // }, 1000);
                        } else if (res.code == 104) {
                            layer.msg(res.msg);
                            dingdang();//订单页
                        } else if(res.code == 105 || res.code == 106){
                            var code = res.code;
                            $.ajax({
                                url: "city/remittance_login",
                                type: "POST",
                                data: "",
                                success: (res) => {
                                    $('.pay_bounced').show();
                                    $('.online_pay').hide();
                                    $('.pz_yz').show();
                                    $('.close_title').text("城市合伙人汇款凭证");
                                    $('#pz_img').attr("src", res.data.payment_document);
                                    $("#hkAccount").val(res.data.remittance_account);
                                    if(code == 106) {
                                        $(".pz_title_two").text("经核实，汇款记录并未到帐，如有任何疑问请联系平台客服");
                                        $("#hk_num").val(res.data.remittance_account);
                                        $('#orderNumber').val(res.data.order_number);
                                        $(".hk_btn_yz").show();
                                    }
                                },
                                error: (e) => {console.log(e)}
                            })
                        } else {
                            layer.msg(res.msg);
                        }
                    },
                    error: function (res) {
                        console.log(res.status, res.statusText);
                    }
                })
            } else {
                layer.msg('请填写手机号或密码！');
            }
        });
        //下单付款
        $("#app").on("click", ".pay_btn" ,function() {
            let pay_order = $(this).data("order"), pay_money =  $(this).data("money");
            $('.close_title').text("选择付款方式");
            $('.online_pay').show();
            $('.offline_pay').hide();
            $('.pz_yz').hide();
            $('.offline_pz').hide();
            $(".pay_money").data("money", pay_money);
            $('#orderNumber').val(pay_order);
            $.ajax({
                url: "city/cityWhatChatPay",
                type: "POST",
                data: {
                    order_number: pay_order,
                    pay_money: pay_money
                },
                success: (res) => {
                    if(res.code == 1) {
                        $('#payImg').attr("src", res.data.url);
                        $(".pay_main").hide();
                        $(".pay_bounced").show();
                    } else {
                        layer.msg(res.msg);
                    }
                },
                error: (e) => {
                    console.log(e)
                }
            });
            $(".ali_pay").click(function() {
                $.ajax({
                    url: "city/cityAlipayCode",
                    type: "POST",
                    data: {
                        order_number: pay_order,
                        pay_money: pay_money
                    },
                    success: (res) => {
                        if(res.code == 1) {
                            $('body').append(res.data.url);
                        } else {
                            layer.msg(res.msg);
                        }
                    },
                    error: (e) => {
                        console.log(e)
                    }
                })
            })
        });
        //订单页
        function dingdang() {
                $.ajax({
                    url: "city/city_order_index",
                    type: "POST",
                    data: {},
                    success: (res) => {
                        var data = res.data;
                        if (res.code == 1) {
                            var dhtml = `<div class="pay_box">
                                        <div class="c_city">您选择城市：<span class="city_n">${data.city_address}</span></div>
                                        <div class="pay_table">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th class="th_one">
                                                            <span><input type="checkbox" name="" id="" checked>${formatDate(data.create_time)}</span>
                                                            <span  style="margin-left: 30px;">订单号：${data.order_number}</span>
                                                        </th>
                                                        <th>数量</th>
                                                        <th>介绍</th>
                                                        <th>金额</th>
                                                        <th>小计（元）</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="tr_one">${data.city_meal_name}</td>
                                                        <td>${data.number}年</td>
                                                        <td style="color: rgb(174,174,174);">${data.selling_point}</td>
                                                        <td>
                                                            <div>${data.meal_price.toFixed(2)}</div>
                                                            <div class="tips">${data.line_price.toFixed(2)}</div>
                                                        </td>
                                                        <td>${data.meal_price.toFixed(2)}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="pay_invoice">
                                            <div><input type="checkbox" name="invoice" id="" onchange="makeInvoice(${data.user_id})"><label for="invoice">我要开票</label></div>
                                            <div class="poundage">0.00</div>
                                        </div>
                                        <div class="pay_k">
                                            <div><div class="pay_t">实付款：<span class="pay_mon">￥${data.meal_price.toFixed(2)}</span></div></div>
                                            <div><span class="close_order">取消订单</span><span class="pay_btn" data-order="${data.order_number}" data-money="${data.meal_price.toFixed(2)}">提交订单</span></div>
                                        </div>
                                    </div>`;
                            $('#app').show();
                            $('#app').empty();
                            $("input[name=user_id]").val(data.user_id);
                            $(".pay_money").text(data.meal_price.toFixed(2));
                            $("input[name=price]").val(data.meal_price.toFixed(2));
                            $("input[name=order_price]").val(data.meal_price.toFixed(2));//凭证金额
                            $("input[name=no]").val(data.order_number);
                            $('#app').append(dhtml);
                        }
                    },
                    error: (e) => { console.log(e) }
                })
            }

    </script>
</body>
</html>