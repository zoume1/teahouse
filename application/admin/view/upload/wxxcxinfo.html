{include file="template/_meta" /}
<title></title>
</head>

{block name="css"}
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/css/aaa.css" />
<style type="text/css">
    * {margin: 0;padding: 0;}
    body {background: #fff;}
    .wrapper {padding: 20px 10px;}

    .title {border-bottom: 1px solid #c9c9c9;padding-bottom: 5px;}
    .title a{font-size: 18px; padding: 0 10px 5px; color: #333;}
    .title .tit-on {color: #0066FF;border-bottom: 2px solid #21a5fa;}
    
    .items {margin-top: 30px;}
    .item {display: flex;margin-bottom: 20px;}
    .item .item-key {width: 200px;text-align: right;font-size: 16px;color: #666;}
    .item .item-value {color: #333;}
    .item .item-value input {height: 25px;padding-left: 5px;}
    textarea {width: 400px;height: 100px;resize: none;padding: 10px;box-sizing: border-box;font-size: 16px;}
    .save {margin-left: 200px;padding: 3px 25px;color: #fff;background-color: #169bd5;border: 0;border-radius: 2px;cursor: pointer;outline: none;}
    .update {background-color: #fff;border: 0;color: #169bd5;cursor: pointer;outline: none;}
    .imgUpload {opacity: 0;filter: alpha(opacity=0);}
    /* 数据库展现图片样式 */
    .img {position: relative;display: inline-block;width: 100px;}
    .imgcontent {margin: 10px;}
    .img>i {display: inline-block;width: 20px;position: absolute;right: 0;top: 0;}
    .on {
        color: #21A5FA !important;
        border-bottom: solid 3px #21A5FA;
    }
    .distribution_list {
        margin-bottom: 10px;
        border-bottom: solid 1px #D7D7D7;
    }
    
    .distribution_list ul {
        display: flex;
        align-items: center;
    }
    
    .distribution_list a {
        font-size: 14px;
        padding: 9px;
        color: #5E5E5E;
    }
    .btn.green {
    color: #fff;
    text-shadow: none;
    background-color: #35aa47;
}

</style>
{/block}
    <input type="hidden" id="nowhtml" value="navSystem" class="navSystem10">
        <!-- <ul class="breadcrumb">
            <li>
                <i class="icon-home"></i>
                填写信息--{$applet.name}
            </li>
        </ul> -->
        <div class="row-fluid" style="margin-top: 100px;">
            <div class="portlet box">
                <div class="portlet-body form" style="">
                        <div style="display: flex;flex-direction: row;font-size:18px;justify-content:center;text-align:center">
                            <div class="one active">
                                <span style="width:30px;height:30px;line-height:30px;background:#428bca;color:#fff;display: inline-block;border-radius: 30px!important;">1</span> 填写信息
                            </div>
                            <img src="/image/btn_jt.png" alt="" style="width:40px;height:40px;margin:0 50px">
                            <div id="two_all">
                                <span style="width:30px;height:30px;line-height:30px;background:#999;color:#fff;display: inline-block;border-radius: 30px!important;">2</span> 扫码并上传代码
                            </div>
                            <img src="/image/btn_jt.png" alt="" style="width:40px;height:40px;margin:0 50px">
                            <div id="three_all">
                                <span style="width:30px;height:30px;line-height:30px;background:#999;color:#fff;display: inline-block;border-radius: 30px!important;">3</span> 上传成功
                            </div>
                        </div>
                        
    
                        <div style="margin:80px auto 0;width:460px;">
                            <div style="display: none;width: 140px;text-align: center;margin: 0px auto 30px;" id="yulanimg">
                                <img src="" alt=""  style="width:140px;height:140px;margin:0 auto">
                                <div>微信扫码预览小程序</div>
                            </div>
                            <div class="control-group" style="margin-bottom: 30px">
                                <span style="width:100px;text-align: right;display: inline-block;">版本号：<span style="color:#f00">*</span></span>
                                <input name="version" id="version" type="text" class="span3 m-wrap" value=""  style="height: 35px !important;margin-right: 30px;width:314px" />
                                <div style="margin-left: 110px;margin-top:-5px;color:#999999">版本号仅限数字，且不能为空</div>
                            </div>
                            <div class="control-group" style="margin-bottom: 30px">
                                <span style="width:100px;text-align: right;display: inline-block;">版本描述： </span>
                                <textarea name="desc" id="desc" style="width:300px" rows="3"></textarea>
                            </div>
                            <div class="control-group" id="preview" style="margin-bottom: 30px;display: none">
                                <span style="width:100px;text-align: right;display: inline-block;">预览二维码： </span>
                                <img src="" style="width: 200px" alt="">
                            </div>
                            <div style="width:140px;margin:0 auto">
                                <a href="javascript:;" class="btn green" onclick="wx_login()">扫码登录</a>
                                <!-- <a href="javascript:;" class="btn green" onclick="upload()">上传代码</a> -->
                            </div>
                            <!-- <div style="text-align: center;color:#999;margin-top: 10px">只有上传代码才需要添加版本号和版本描述，预览无需填写</div> -->
                        </div>
                        <input type="hidden" name="id" value="{$applet['id']}" >
                        <!-- <div id="success" style="display: none;width: 430px;text-align: center;margin: 30px auto 0;">
                            <p>上传代码成功，请到微信开发平台小程序后台预览，提交审核应用</p>
                            <p>微信开发平台小程序后台<a href="https://mp.weixin.qq.com/" target="_blank">https://mp.weixin.qq.com/</a> </p>
                            <a href="https://mp.weixin.qq.com/" target="_blank" class="btn green">去提交审核</a>
                        </div> -->
                </div>
            </div>
        </div>
        <!-- <script type="text/javascript" src="/js/jquery.js"></script> -->
       
    <!--_footer 作为公共模版分离出去-->
    {include file="template/_footer" /}
    <!--/_footer 作为公共模版分离出去-->

    <!--请在下方写此页面业务相关的脚本-->
    {block name="bottom"}
    <script>
        var code_uuid = "{$code_uuid}";
        var scan_token = "{$scan_token}";
        function yulan() {
            $.ajax({
                url : "{:Url('Upload/preview')}?token="+scan_token+"&uuid="+code_uuid,
                type:"get",
                success:function (res) {
                    var res = JSON.parse(res);
                    $("#preview").find("img").attr('src',"data:image/jpg;base64,"+res.data.qrcode_img);
                    $("#preview").show();
                }
            });
        }
        
        function upload() {
            var version = $("input[name='version']").val();
            var desc = $("#desc").val();
            if(version == ""){
                alert("版本号不能为空");
                return false;
            }
            $.ajax({
                url : "{:Url('Upload/commitcode')}",
                type:"post",
                data:{
                    token : scan_token,
                    uuid : code_uuid,
                    version:version,
                    desc : desc
                },
                success:function (res) {
                    if(res.errno>0){
                        // alert("上传失败，请重试！如一直失败，请过几分钟后再上传！");
                        alert("上传失败!错误描述："+res.message);
                    }else{
                        $("#three_all span").css('background','#428bca');
                        $("#success").show();
                    }
                }
            });
        }

        function wx_login(){
            var version = $("#version").val();
            var desc = $("#desc").val();
            var appletid=$('input[name="id"]').val();
            location.href = "wx_login2?appletid="+appletid+"&version="+version+ "&desc="+desc;
        }
    </script>
    {/block}

</body>

</html>