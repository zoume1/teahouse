
{include file="template/_meta" /}
<title></title>
</head>

{block name="css"}
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/css/aaa.css" />

<style type="text/css">
    *{margin: 0;padding: 0;}        
    body {background: #fff;}   
    .fl{float: left;}     
    .wrapper {padding: 20px;}  
    .clearfix::after{content: ''; display: block; clear: both; overflow: hidden;}      
    .title {border-bottom: 1px solid #c9c9c9;padding-bottom: 5px;}        
    .title a {font-size: 18px;padding: 0 10px 5px;color: #333; text-decoration: none;}        
    .title .tit-on {color: #0066FF;border-bottom: 2px solid #21a5fa;}        
    .form-group .layui-form-select {display: none;}
    .addr-block{margin: 30px 0;}
    .addr-block .addr-label{width: 88px; padding-right: 12px; text-align: right;}
    .addr-block .addr-label[required]::before{content: '*'; color: #f00;}
    .addr-block li{line-height: 34px; margin-bottom: 15px;}
    .addr-block textarea{resize: none; width: 444px; height: 40px; border-radius: 4px; border: 1px solid #ccc; padding: 8px;}
    .addr-block input[type=text]{width: 448px; border-radius: 4px; border: 1px solid #ccc; padding-left: 10px;}
    .save-btn{background-color: #5584ff; border: 1px solid transparent; border-radius: 4px; color: #fff; padding: 0 12px; height: 28px; line-height: 26px;}
    .addressList{width: 850px;}
    .maximum{padding: 12px; background-color: #e3f2fd; border-color: #e3f2fd; border-radius: 3px; width: 826px; margin-bottom: 20px;}
    .maximum .icon-prompt{width: 16px; height: 16px; background: url(__STATIC__/admin/common/img/icon-prompt.png) no-repeat; background-size: contain;}
    .maximum .max-message{padding-left: 20px; color: #666; font-size: 12px;}
    .next-table table{width: 100%; border-spacing: 0; border-collapse: collapse; background: #fff; font-size: 12px;}
    .next-table th{padding: 0; background-color: #ebecf0; color: #333; text-align: left; font-weight: 400; border: 1px solid #dcdee3;}
    .next-table .next-table-cell-wrapper{padding: 12px 16px; overflow: hidden; text-overflow: ellipsis; word-break: break-all;}
    .next-table-bd .next-table-row{transition: all .3s ease;}
    .next-table-bd .next-table-row:hover{background-color: #f2f3f7;}
    .next-table td{border: 1px solid #dcdee3; padding: 0;}
    table .t-default{display: block; width: 80px; height: 30px; line-height: 30px; border: 1px solid #ff5000; color: #f30; background-color: #ffd6cc; border-radius: 3px; text-align: center;}
    table a{color: #333;}
    table a:hover{color: #f40;}
    table .t-delete:hover{color: #f40; cursor: pointer;}
    table .t-setDefault:hover{cursor: pointer; color: #f40;}
    .on {
        color: #21A5FA !important;
        border-bottom: solid 3px #21A5FA;
    }
    .distribution_list {
        margin-bottom: 10px;
        border-bottom: solid 1px #D7D7D7;
    }
    
    .distribution_list ul {
        display: flex;
        align-items: center;
    }
    
    .distribution_list a {
        font-size: 14px;
        padding: 9px;
        color: #5E5E5E;
    }
</style>

{/block}
<body>

    {block name="content"}
    <div class="wrapper">
        {include file="template/_top" /}
        <div class="addr-block">
            <ul>
                <li class="clearfix">
                    <label required class="fl addr-label">地址信息:</label>
                    <div class="form-inline fl">
                        <div data-toggle="distpicker">
                            <div class="form-group">
                                <label class="sr-only" for="province2">Province</label>
                                <select class="form-control" name="address_city[]" id="province" data-province="---- 选择省 ----"></select>
                            </div>
                            <div class="form-group">
                                <label class="sr-only" for="city2">City</label>
                                <select class="form-control" name="address_city[]" id="city" data-city="---- 选择市 ----"></select>
                            </div>
                            <div class="form-group">
                                <label class="sr-only" for="district2">District</label>
                                <select class="form-control" name="address_city[]" id="district" data-district="---- 选择区 ----"></select>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="clearfix">
                    <label required class="addr-label fl">详细地址:</label>
                    <div class="fl">
                        <textarea placeholder="请输入详细地址信息，如道路、门牌号、小区、楼栋号、单元等信息" name="street" id="street"></textarea>
                    </div>
                </li>
                <li class="clearfix">
                    <label class="addr-label fl">邮政编码:</label>
                    <div class="fl">
                        <input type="text" placeholder="请填写邮编" name="zip" id="zip">
                    </div>
                </li>
                <li class="clearfix">
                    <label required class="addr-label fl">联系电话:</label>
                    <div class="fl">
                        <input type="text" placeholder="填写联系电话" name="phone" id="phone">
                    </div>
                </li>
                <li class="clearfix">
                    <label required class="addr-label fl">收货人姓名:</label>
                    <div class="fl">
                        <input type="text" placeholder="长度不超过25个字符" name="name" id="name">
                    </div>
                </li>
                <li class="clearfix">
                    <label class="addr-label fl"></label>
                    <div class="fl">
                        <input type="checkbox" name="default" value="" id="default">
                        <label for="default">设置为默认收货地址</label>
                    </div>
                </li>
                <li class="clearfix">
                    <label class="addr-label fl"></label>
                    <div class="fl">
                        <button class="save-btn">保存</button>
                    </div>
                </li>
            </ul>
        </div>
        <div class="addressList">
            <div class="maximum">
                <i class="icon-prompt fl"></i>
                <div class="max-message">已保存2了条地址，还能保存3条地址</div>
            </div>
            <div class="next-table">
                <table>
                    <colgroup>
                        <col style="width: 70px;">
                        <col>
                        <col style="width: 200px;">
                        <col style="width: 100px;">
                        <col style="width: 140px;">
                        <col style="width: 110px;">
                        <col style="width: 90px;">
                    </colgroup>
                    <thead class="next-table-hd">
                        <tr>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper">收货人</div>
                            </th>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper">所在地区</div>
                            </th>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper">详细地址</div>
                            </th>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper">邮编</div>
                            </th>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper">电话/手机</div>
                            </th>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper">操作</div>
                            </th>
                            <th class="next-table-cell">
                                <div class="next-table-cell-wrapper"></div>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="next-table-bd">
                    {if !empty($data)}
                    {volist name="data" id="vo"}
                        <tr class="next-table-row">
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">{$vo.name}</div>
                            </td>
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">{$vo.address}</div>
                            </td>
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">{$vo.street}</div>
                            </td>
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">{$vo.zip}</div>
                            </td>
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">{$vo.phone}</div>
                            </td>
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">
                                    <div class="tAction">
                                        <a href="javascript:void(0);" target="_self" class="editAddr" data-id="{$vo.id}">修改</a>
                                        <span class="t-line">|</span>
                                        <span class="t-delete" data-id="{$vo.id}">删除</span>
                                    </div>
                                </div>
                            </td>
                            <td class="next-table-cell">
                                <div class="next-table-cell-wrapper">
                                    {if $vo['default']==0}
                                    <span class="t-setDefault" data-id="{$vo.id}">设为默认</span>
                                    {else}
                                    <div>
                                        <span class="t-default">默认地址</span>
                                    </div>
                                    {/if}
                                </div>
                            </td>
                        </tr>
                    {/volist}
                    {/if}
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    {/block}

    <!--_footer 作为公共模版分离出去-->
    {include file="template/_footer" /}
    <!--/_footer 作为公共模版分离出去-->

    <!--请在下方写此页面业务相关的脚本-->
    {block name="bottom"}
    <script src="https://cdn.bootcss.com/layer/2.3/layer.js"></script>
    <script>
        (function(){
            
            // ajax post
            function postData(url, param, callback){
                $.post(url, param, function(data, status){
                    callback(JSON.parse(data));
                })
            }
            // 保存按钮
            $('.save-btn').click(function(){
                var address = $('#province').val() + ' ' + $('#city').val() + ' ' + $('#district').val(),
                    street = $('#street').val(),
                    zip = $('#zip').val(),
                    phone = $('#phone').val(),
                    name = $('#name').val(),
                    def = $('#default')[0].checked ? 1 : 0,
                    id = this.getAttribute('data-id') == null ? '' : this.getAttribute('data-id');
                var param = {
                    id: id,
                    address: address,
                    street: street,
                    zip: zip,
                    phone: phone,
                    name: name,
                    default:def
                }
                postData('general_address_add', param, saveData);
            })
            
            // 保存发送数据 回调
            function saveData(data){
                if(data.status == 1){
                    layer.msg(data.info, {time: 1000});
                    setTimeout(function(){
                        location.reload();
                    }, 1100)
                }
            }
            // 设置默认
            $('.t-setDefault').click(function(){
                var id = this.getAttribute('data-id');
                var param = {
                    id: id
                }
                postData('general_address_status', param, combineCallBack);
            })
            // 设为默认 回调
            function combineCallBack(data){
                if(data.status == 1){
                    layer.msg(data.info, {time: 1000});
                    setTimeout(function(){
                        location.reload();
                    }, 1100)
                }
            }

            // 删除
            $('.t-delete').click(function(){
                var id = this.getAttribute('data-id');
                var param = {id: id};
                if(confirm('删除本条地址？')){
                    postData('general_address_del', param, combineCallBack);
                }
            })

            // 修改地址 按钮
            $('.editAddr').click(function(){
                var id = this.getAttribute('data-id');
                var param = {id: id};
                postData('general_address_edit_info', param, editFunc);
            })
            // 修改地址 回调
            function editFunc(data){
                console.log(data);
                $('#p-dist').distpicker('destroy').distpicker({autoSelect: false});
                $('#province').val(data.data.address.split(' ')[0]).trigger('change');
                $('#city').val(data.data.address.split(' ')[1]).trigger('change');
                $('#district').val(data.data.address.split(' ')[2]).trigger('change');
                $('#street').val(data.data.street);
                $('#zip').val(data.data.zip);
                $('#phone').val(data.data.phone);
                $('#name').val(data.data.name);
                data.data.default ? $('#default').prop('checked', true) : $('#default').prop('checked', false);
                $('.save-btn').attr('data-id', data.data.id);
            }

        })()
        

    </script>
    {/block}