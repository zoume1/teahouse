<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>确认订单信息</title>
    <link rel="stylesheet" href="__STATIC__/admin/common/css/z-comm.css">
    <link rel="stylesheet" href="__STATIC__/admin/common/layui/css/layui.css">
    <style>
        *{margin: 0; padding: 0;}
        i{font-style: normal;}
        .triangle::after{content: ''; position: absolute; left: 50%; top: 110%; margin-left: -4px; width: 0; height: 0; border: 5px solid transparent; border-top-color: #f00;}
        .wrapper{padding: 0 60px; position: relative;}
        .header{display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #bcbcbc; width: 1300px; margin: 0 auto 50px;}
        .step{font-size: 14px; color: #868686; margin: 0 30px; line-height: 3em;}
        .step-on{font-size: 20px; color: #333; font-weight: 700;}
        .step-line{width: 35px; border-top: 1px dashed #868686;}
        .main-bg{background-color: #f7f7f7; border: 1px solid #e4e4e4;}
        .main{width: 1300px; min-height: 700px; margin: 0 auto; background-color: #fff; padding: 0 25px; box-sizing: border-box;}
        .shop-name{font-size: 14px; color: #949494; padding: 5px 0;}
        .shop-name span{color: #000;}
        .cart-item{border: 1px solid rgb(207, 236, 255); margin-bottom: 20px;}
        .carts-head{display: flex; align-items: center;height: 40px; background-color: #cfecff; border-bottom: 1px solid rgb(168, 221, 255); padding: 0 8px;}
        .carts-head div{text-align: center; font-size: 14px;}
        .carts-head .unit-text,
        .carts-head .money-text,
        .carts-head .tatal-text{font-weight: 700;}
        .carts-head .time{flex-basis: 10%; text-align: left;}
        .carts-head .order-number{flex-basis: 20%; text-align: left;}
        .carts-head .unit-text{flex-basis: 30%;}
        .carts-head .money-text{flex-basis: 30%;}
        .goods-item{height: 100px; display: flex; align-items: center;}
        .img-box{flex-basis: 10%; text-align: center;}
        .goods-name{flex-basis: 20%; text-align: center; font-size: 15px; color: #333;}
        .counter{flex-basis: 33%; text-align: center;}
        .counter .minus,
        .counter .plus{width: 40px; border: 1px solid #e7e7e7; height: 30px; box-sizing: border-box; background-color: transparent; cursor: pointer; outline: none; font-size: 14px; color: #333;}
        .counter .minus{border-right: 0; border-top-left-radius: 4px; border-bottom-left-radius: 4px; margin-right: -4px;}
        .counter .plus{border-left: 0; border-top-right-radius: 4px; border-bottom-right-radius: 4px; margin-left: -4px;}
        .counter input{width: 50px; text-align: center; height: 30px; box-sizing: border-box; border: 1px solid #e7e7e7; outline: none; font-size: 14px;}
        .counter .unit{font-size: 16px; margin-left: 5px;}
        .unit-price{flex-basis: 26%; text-align: center; font-size: 16px; color: #333;}
        .total-price-box{flex-basis: 8%; text-align: center;}
        .total-price-box .del-order{border: 0; background-color: transparent; font-size: 14px; color: #0099FF; outline: none; cursor: pointer;}
        .total-price-box .total-price{font-size: 14px; color: #333; margin-bottom: 5px;}
        .agreement{font-size: 14px; color: #333; margin-bottom: 10px;}
        .agreement i{color: #0099FF; font-size: 13px; cursor: pointer;}
        .invite-code{font-size: 14px; color: #333; margin-bottom: 10px;}
        .invite-code span{color: #a1a1a1;}
        .invite-code span i{color: #f00;}
        .invite-code .invite-code-input{display: block; width: 270px;}
        .settlement-cont{background-color: rgb(244, 251, 255); text-align: right; padding: 15px 20px;}
        .settlement-cont p{margin-bottom: 10px;}
        .settlement-cont .total{font-size: 15px; color: #333;}
        .settlement-cont .discount{font-size: 13px; color: #949494;}
        .settlement-cont .payment{font-size: 18px; color: #f44;}
        .settlement-cont button{width: 140px; height: 40px; text-align: center; line-height: 40px; background-color: #f44; color: #fff; font-size: 16px; border: 0; outline: none; cursor: pointer;}
        .settlement-cont button:disabled{background-color: #a1a1a1;}
        
        .payment-pop,
        .voucher-pop{position: absolute; top: 50%; left: 50%; margin: -280px 0 0 -280px; min-height: 560px; width: 560px; padding: 0 18px; box-sizing: border-box; border-radius: 5px; background-color: #fff; z-index: 99;}
        .pop-title{position: relative; font-size: 16px; font-weight: 700;padding: 15px 0; border-bottom: 1px solid #e5e5e5; margin-bottom: 15px; color: #666;}
        .close{position: absolute; right: 0; top: 50%; transform: translateY(-50%); font-size: 20px; color: #949494; width: 20px; height: 20px; text-align: center; line-height: 20px; cursor: pointer;}
        .select-way{color: #787878; border-bottom: 1px solid #e5e5e5; margin-bottom: 10px;}
        .select-way .dpf{display: flex; align-items: baseline; margin-bottom: 15px;}
        .select-way .dpf .key{width: 80px; font-size: 14px;}
        .select-way .payment-amount .value{font-size: 20px; color: #ff6600;}
        .method .value>div{margin-bottom: 5px;}
        .method .balance-show{float: right; margin-left: 90px; text-align: right;}
        .method .balance-show .fund-balance{color: #f00;}
        .method .balance-show button{background-color: #f00; color: #fff; border: 0; padding: 2px 5px; border-radius: 3px; outline: none; cursor: pointer; margin-left: 10px;}
        .switch-way-cont .scan-way{text-align: center;}
        /* .switch-way-cont .scan-way .code-box{width: 200px; height: 200px;} */
        /* .switch-way-cont .scan-way .code-box img{width: 100%; height: 100%;} */
        .switch-way-cont .scan-way .scan-tip{font-size: 28px; color: #333;}
        .switch-way-cont .scan-way .support{margin: 10px 0;}
        .remit-info-box{border: 1px solid #e5e5e5; padding: 25px 20px; border-radius: 4px; font-size: 15px; color: #111; margin-bottom: 20px;}
        .remit-way .remit-money{font-size: 20px; color: #333; margin: 0 5px;}
        .remit-info-box>p{margin-bottom: 10px;}
        .remit-way button{color: #fff; background-color: #3388ff; border-radius: 4px; border: 0; padding: 6px 20px; cursor: pointer; float: right; font-size: 16px;}
        .balance-inner-box{border: 1px solid #e5e5e5; border-radius: 5px; padding: 30px; margin: 0 auto;}
        .password-box{position: relative; height: 70px; margin-bottom: 10px;}
        .password-input{width: 100%; height: 70px; opacity: 0; position: absolute; top: 0; left: 0; z-index: 2;}
        .password-box .gif-box{position: absolute; top: 0; left: 0; width: 100%; height: 70px; display: flex; align-items: center; border: 1px solid #797979; box-sizing: border-box; cursor: text;}
        .password-box .gif-box i{flex: 1; height: 100%; display: flex; align-items: center; justify-content: center;}
        .password-box .gif-box i:not(:last-child){border-right: 1px solid #797979;}
        .password-box .gif-box i.active{background: url(__STATIC__/admin/common/img/password-blink.gif) no-repeat center center; border: 1px solid #f60;}
        .gif-box i b.activeDot{background: url(__STATIC__/admin/common/img/passeord-dot.png) no-repeat center center; display: block; width: 7px; height: 7px;}
        .forget-pwd{text-align: right; font-size: 14px; font-weight: 700; cursor: pointer;}
        .forget-pwd a{color: #0099FF;}
        .balance-comfirm{float: right; padding: 5px 25px; color: #fff; background-color: #0099ff; border: 0; outline: none; cursor: pointer; border-radius: 4px; margin-top: 10px;}

        .payee-title,
        .payer-title{font-size: 15px; color: #949494; margin: 10px 0;}
        .k-label{display: inline-block; width: 120px; text-align: right; color: #666; margin-right: 10px;}
        .payee-info{border-bottom: 1px dashed #797979;}
        .payee-info .payee-p{margin-bottom: 20px;}
        .v-span{font-size: 15px; color: #333; font-weight: 700;}
        .payer-p{margin-bottom: 20px;}
        .payer-p input{width: 220px; height: 35px; border-radius: 4px; padding-left: 10px; box-sizing: border-box; border: 1px solid #d7d8d9;}
        .voucher-pop button{color: #fff; background-color: #3388ff; border-radius: 4px; border: 0; padding: 6px 20px; cursor: pointer; float: right; font-size: 16px; margin-top: 20px;}

        .addrs .addrs-tit{font-size: 14px; color: #333; margin: 15px 0; line-height: 25px; font-weight: 700;}
        .addrs .addr{display: inline-block; position: relative; vertical-align: top; width: 237px; margin: 0 14px 14px 0; color: #666; cursor: pointer;}
        .addrs .addr:last-of-type{margin-right: 0;}
        .addrs .addr .inner{position: relative; padding: 11px 15px; z-index: 2;font-size: 12px; background: url(__STATIC__/admin/common/img/icon-a.png) no-repeat; min-height: 106px; box-sizing: border-box;}
        /* .addrs .addr-active .inner, */
        .addrs .addr-cur .inner,
        .addrs .addr .inner:hover{background-image: url(__STATIC__/admin/common/img/icon-a2.png);}
        .addrs .addr .cur-marker{position: absolute; right: 1px; top: 77px; width: 28px; height: 28px; background: url(__STATIC__/admin/common/img/icon-s2.png) no-repeat; z-index: 3; visibility: hidden;}
        .addrs .addr-cur .cur-marker{visibility: visible;}
        .addrs .addr-set.addr-cur:hover .set-default{display: block;}
        .addrs .addr .set-default,
        .addrs .addr .default-tip{position: absolute; top: 0; right: 0; padding: 0 2px; text-decoration: 0; z-index: 3; opacity: .7; filter: alpha(opacity=70); display: none;}
        .addrs .addr-cur .set-default:hover{color: #c97;}
        .addrs .addr .set-default{background-color: #fff; color: #666;}
        .addrs .addr .default-tip{background-color: #ccc; color: #fff;}
        .addrs .addr .addr-hd{width: 100%; padding: 0 0 5px; border-bottom: 1px solid #f2f2f2; margin-bottom: 5px; white-space: nowrap; text-overflow: ellipsis; line-height: 18px;}
        .addrs .addr .addr-hd span{display: inline-block; vertical-align: top; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;}
        .addrs .addr .city{font-weight: 700; margin-right: 10px; max-width: 64px;}
        .addrs .addr .addr-bd{height: 55px; overflow: hidden; word-break: break-all; word-wrap: break-word;}
        .addrs .addr-cur .addr-bd{height: 36px;}
        .addrs .addr .addr-bd span{margin-right: 3px; word-break: break-all; word-wrap: break-word;}
        .addrs .addr .addr-toolbar{display: none;}
        .addrs .addr-cur .addr-toolbar{display: block;}
        .addrs .addr a{color: #c97; text-decoration: none;}
        .addrs .addr a:hover{color: #ff0036;}
        .addrs .operate-addr{font-size: 12px; color: #c97; cursor: pointer; margin-bottom: 20px;}
        .addrs .operate-addr span:hover{color: #ff0036;}
        /* 协议 */
        .protocol-pop{position: absolute; left: 50%; top: 50%; width: 900px; height: 500px; padding: 40px 30px 20px; box-sizing: border-box; transform: translate(-50%, -50%); background-color: #fff; border-radius: 5px; z-index: 99;}
        .protocol-pop>div{width: 100%; height: 100%; overflow: auto;}
        .protocol-pop h3{text-align: center; font-size: 28px;}
        .protocol-pop .bh{margin-top: 20px;}
        .protocol-pop .cl{position: absolute; right: 10px; top: 5px; width: 30px; height: 30px; cursor: pointer; text-align: center; line-height: 30px; font-size: 30px; color: #333;}

        /* 邀请码蒙灰 */
        .bandCode{background-color: #aaa;}
    </style>
</head>
<body>
    <div class="wrapper" id="app" v-cloak>
        <div class="header">
            <div class="step">1.选择服务</div>
            <div class="step-line"></div>
            <div class="step step-on">2.确认订单信息</div>
            <div class="step-line"></div>
            <div class="step">3.确认付款</div>
            <div class="step-line"></div>
            <div class="step">4.完成订购</div>
            <div class="step-line"></div>
            <div class="step">5.追加评论</div>
        </div>
        <div class="main-bg">
            <div class="main">
                <div class="addrs" v-if="virtualTag && zzVir">
                    <h2 class="addrs-tit">选择收货地址</h2>
                    <div class="addr-list">
                        <div class="addr"
                            v-for="(v, i) in addrData"
                            :key="i"
                            :class="{'addr-cur': addrSelectedIdx==i, 'addr-set': !v.default}">
                            <div class="inner"
                                @click="selectAddr(i, v.id)">
                                <div class="addr-hd">
                                    <span class="prov">{{v.prov}}</span>
                                    <span class="city">{{v.city}}</span>
                                    <span>（</span>
                                    <span>{{v.name}}</span>
                                    <span>收）</span>
                                </div>
                                <div class="addr-bd">
                                    <span class="dist">{{v.dist}}</span>
                                    <span class="street">{{v.street}}</span>
                                    <span class="phone">{{v.phone}}</span>
                                </div>
                                <div class="addr-toolbar">
                                    <a href="javascript:void(0);"
                                        @click="modifyAddr">修改</a>
                                </div>
                            </div>
                            <div class="cur-marker"></div>
                            <div class="set-default" title="设置当前地址为默认"
                                @click="setDefaultAddr(v.id)">设为默认</div>
                            <div class="default-tip" style="display: block;"
                                v-if="v.default">默认地址</div>
                        </div>
                    </div>
                    <div class="operate-addr">
                        <span @click="toEditAddr">管理收货地址</span>
                    </div>
                </div>
                <template v-if="">
                    <div class="carts" 
                        v-for="(item, index) in orderInfo"
                        :key="index"
                    >
                        <p class="shop-name">订购店铺：<span>{{item.store_name}}</span></p>
                        <div class="cart-item">
                            <div class="carts-head">
                                <input type="checkbox" checked @change="selectGoods(item, index, $event)">
                                <div class="time">{{timetrans(item.create_time)}}</div>
                                <div class="order-number">订单号：{{item.order_number}}</div>
                                <div class="unit-text">数量</div>
                                <div class="money-text">金额</div>
                                <div class="total-text">小计（元）</div>
                            </div>
                            <div class="goods-item">
                                <div class="img-box">
                                    <img :src="item.images_url" width="50" height="50">
                                </div>
                                <div class="goods-name">{{item.goods_name}}</div>
                                <div class="counter">

                                    <template v-if="virtualTag">
                                        <button class="minus" @click="minusEvent(item)">-</button>
                                        <input type="num" 
                                            v-model="item.goods_quantity"
                                            @keyup="inputNumber(item, index)"
                                            ref="num">
                                        <button class="plus" @click="plusEvent(item)">+</button>
                                    </template>
                                    <template v-else>
                                        {{item.year}}
                                    </template>

                                    <span class="unit">{{item.unit}}</span>
                                    
                                </div>
                                <div class="unit-price">{{item.amount_money.toFixed(2)}}</div>
                                <div class="total-price-box">
                                    <p class="total-price">{{(item.goods_quantity * item.amount_money).toFixed(2)}}</p>
                                    <!-- 增值商品 隐藏删除订单按钮 -->
                                    <button v-if="zzspBool" class="del-order" @click="delEvent(item.order_number)">删除订单</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="agreement">
                        <input type="checkbox" id="agreement" 
                            :checked="protocolFlag"
                            @change="agreement">
                        <label for="agreement">我已阅读并同意</label>
                        <i @click="showProtocolEvent">《智慧茶仓商家服务协议》</i>
                    </div>
                    <div class="invite-code" v-if="zzspBool">
                        <input type="checkbox" id="invite-code"
                            @change="useDiscount"
                            :checked="inputCodeYet">
                        <label for="invite-code">使用邀请码 <span>(填写推荐邀请码，优惠<i>{{discountPrice}}</i>元)</span></label>
                        <input type="text" :class="{'invite-code-input': true, 'bandCode': inputCodeYet}" placeholder="填写您的邀请人的会员绑定手机号或邀请码"
                            v-show="showInviteCode"
                            v-model="inviteCode"
                            :readonly="inputCodeYet"
                        >
                    </div>
                </template>
                <div class="settlement-cont">
                    <!-- <p class="total">合计：￥{{ totalPrice }}</p> -->
                    <!-- <p class="discount">优惠：￥{{ virtualTag ? 0 : showDiscount }}</p> -->
                    <!-- <p class="payment">应付款：￥{{ virtualTag ? payment : virtualPayment }}</p> -->
                    <p class="payment">实付款：￥{{ virtualTag ? payment : virtualPayment }}</p>
                    <p class="discount">已扣减：{{ virtualTag ? 0 : showDiscount }}</p>
                    <button 
                        :disabled="orderInfo.length?!protocolFlag:protocolFlag"
                        @click="buy"
                    >立即付款</button>
                </div>
            </div>
        </div>
        <div class="mask" v-if="showPayWay||showVoucherPop||showProtocol"></div>
        <!-- 支付方式 -->
        <div class="payment-pop" v-if="showPayWay">
            <p class="pop-title">
                <span>选择付款方式</span>
                <span 
                    class="close"
                    @click="closePop"
                >×</span>
            </p>
            <div class="select-way">
                <div class="name dpf">
                    <div class="key">商家名称：</div>
                    <div class="value">siring</div>
                </div>
                <div class="payment-amount dpf">
                    <div class="key">支付金额：</div>
                    <div class="value">{{virtualTag ? payment : virtualPayment}}元</div>
                </div>
                <div class="method dpf">
                    <div class="key">支付方式：</div>
                    <div class="value">
                        <div>
                            <input 
                                type="radio" 
                                name="way" 
                                id="scan"
                                :checked="wayFlag==1"
                                @change="changePayWay(1)"
                            >
                            <label for="scan">扫码支付</label>
                        </div>
                        <div v-if="zzspBool">
                            <!-- 增值商品隐藏汇款支付 -->
                            <input 
                                type="radio" 
                                name="way" 
                                id="remit"
                                :checked="wayFlag==2"
                                @change="changePayWay(2)"
                            >
                            <label for="remit">汇款支付</label>
                        </div>
                        <div>
                            <input 
                                type="radio" 
                                name="way" 
                                id="balance"
                                :checked="wayFlag==3"
                                @change="changePayWay(3)"
                            >
                            <label for="balance">余额支付</label>
                            <div class="balance-show">
                                <div>
                                    <span class="fund-balance">资金余额：{{accountMoney}}</span>
                                    <button>立即充值</button>
                                </div>
                                <span v-if="payment>accountMoney">余额不足，可立即充值</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="switch-way-cont">
                <!-- 扫码 -->
                <div class="scan-way" v-show="wayFlag==1">
                    <div class="code-box">
                        <img :src="onlinePayImg" width="200" height="200">
                    </div>
                    <div class="support">
                        <a href="javascript:void(0);">
                            <input type="radio" checked>
                            <img src="__STATIC__/admin/common/img/g3.png" width="32" height="32">
                            <span>微信支付</span>
                        </a>
                        <a href="javascript:void(0);"
                            target="_blank"
                            @click="getAlipay"
                        >
                            <input type="radio" >
                            <img src="__STATIC__/admin/common/img/g4.png" width="32" height="32">
                            <span>支付宝</span>
                        </a>
                    </div>
                    <p class="scan-tip">扫一扫完成支付</p>
                </div>
                <!-- 转账 -->
                <div class="remit-way" v-show="wayFlag==2">
                    <div class="remit-info-box">
                        <p>你需汇款<span class="remit-money">{{virtualTag ? payment : virtualPayment}}</span>至以下账户，汇款成功后上传凭证信息，审核通过后到账</p>
                        <p>收款方户名：北京宣铭科技有限公司</p>
                        <p>收款方开户行：北京农村商业银行股份有限公司</p>
                        <p>收款方账户：0203210103000015884</p>
                    </div>
                    <button @click="uploadVoucher">已转账汇款，我要上传凭证</button>
                </div>
                <!-- 余额 -->
                <div class="balance-way" v-show="wayFlag==3">
                    <div class="balance-inner-box">
                        <div class="password-box clearfix">
                            <input type="password" 
                                maxlength="6"
                                class="password-input"
                                @keyup="inputPwd"
                                @focus="password?'':gifFlag=0"
                                @blur="password?'':gifFlag=-1"
                                v-model="password">
                            <div class="gif-box">
                                <i 
                                    :class="{active: gifFlag==i}"
                                    v-for="(v, i) in 6"
                                    :key="i"
                                >
                                    <b :class="{activeDot: gifFlag>i}"></b>
                                </i>
                            </div>
                        </div>
                        <p class="forget-pwd">
                            <a href="security_setting">忘记资金账号密码？</a>
                        </p>
                    </div>
                    <button class="balance-comfirm"
                        @click="comfirmPwd">确定</button>
                </div>
            </div>
        </div>
        <!-- 上传凭证 -->
        <div class="voucher-pop" v-show="showVoucherPop">
            <p class="pop-title">
                <span>线下汇款凭证</span>
                <span class="close" @click="closeVoucher">×</span>
            </p>
            <div class="payee">
                <p class="payee-title">收款方信息</p>
                <div class="payee-info">
                    <p class="payee-p">
                        <span class="k-label">户名：</span>
                        <span class="v-span">北京宣铭科技有限公司</span>
                    </p>
                    <p class="payee-p">
                        <span class="k-label">开户行：</span>
                        <span class="v-span">北京农村商业银行股份有限公司</span>
                    </p>
                    <p class="payee-p">
                        <span class="k-label">账户：</span>
                        <span class="v-span">0203210103000015884</span>
                    </p>
                </div>
            </div>
            <div class="payer">
                <p class="payer-title">付款方信息</p>
                <div class="payer-info">
                    <p class="payer-p">
                        <label for="payer-name" class="k-label must">付款户名：</label>
                        <input 
                            type="text" 
                            id="payer-name"
                            v-model="remittanceInfo.name"
                        >
                    </p>
                    <p class="payer-p">
                        <label for="payer-account" class="k-label must">付款账号：</label>
                        <input 
                            type="text" 
                            id="payer-account"
                            v-model="remittanceInfo.account"
                        >
                    </p>
                    <p class="payer-p">
                        <span class="k-label">金额：</span>
                        <span>{{payment}}元</span>
                    </p>
                    <p class="payer-p">
                        <label for="date" class="k-label must">付款时间：</label>
                        <input 
                            type="text" 
                            id="remitTime"
                            v-model="remittanceInfo.time"
                            @focus="getRemitTime"
                            readonly
                        >
                    </p>
                </div>
            </div>
            <button @click="voucherConfirm">确认提交</button>
        </div>
        <!-- 协议 -->
        <div class="protocol-pop" v-if="showProtocol">
            <span class="cl" @click="showProtocolEvent">×</span>
            <div>
                <div class="innerBox">
                    <h3>用户使用协议</h3>
                    <p>特别提示：</p>
                    <p>您在使用北京宣铭科技有限公司（以下简称“宣铭”）及关联公司提供的各项服务之前，请您务必审慎阅读、充分理解本协议各条款内容，特别是以粗体标注的部分，包括但不限于免除或者限制责任的条款。如您不同意本服务协议及/或随时对其的修改，您应立即停止注册；您一旦使用宣铭提供的服务，即视为您已了解并完全同意本服务协议各项内容，包括宣铭对服务协议所做的修改，并成为我们的用户。</p>
                    <p class="bh">一、账号注册</p>
                    <p>1、您应当同意本协议的条款并按照页面上的提示完成全部的注册程序。您在进行注册程序或第三方授权登录程序过程中勾选协议即表示您与宣铭达成协议，完全接受本协议项下的全部条款约束。</p>
                    <p>2、当您选择通过第三方授权登录程序进入宣铭，您需授权宣铭收集您的账号昵称及头像等标识化的个人信息，授权完成后，您即成为宣铭的“用户”。
                        当您按照注册页面提示填写信息并注册成功后，您即成为宣铭的“用户”；宣铭将给予您一个用户帐号，密码由您自行设置。该用户帐号和密码由您自行负责保管。
                        您应当对您在宣铭进行的活动和事件负法律责任。</p>
                    <p>3、本协议服务条款和公告可由宣铭定时更新，并按照法定流程进行公示。您在使用相关服务时,应关注并遵守其所适用的相关条款。</p>
                    <p>4、使用同一身份认证信息、同一手机号或经宣铭排查认定多个宣铭账户的实际控制人为同一人的，均视为同一用户。</p>
                    <p>5、您确认，在您开始使用本服务前，您应当具备中华人民共和国法律规定的与您行为相适应的民事行为能力。若您不具备前述与您行为相适应的民事行为能力，则您需要在您监护人的陪同下完成注册，并且您与您的监护人应依照法律规定承担因此而导致的一切后果。</p>
                    <p class="bh">二、注册信息和隐私保护</p>
                    <p>1、您帐号的所有权归宣铭，使用权归您。您按注册页面引导填写信息，阅读并同意本协议且完成全部注册程序后，即可获得注册账号并成为用户。您应提供及时、详尽及准确的个人资料，并不断更新注册资料，符合及时、详尽准确的要求。所有原始键入的资料将引用为注册资料。如果因注册信息不真实或更新不及时而引发的相关问题，由您自行承担相应的责任。</p>
                    <p>2、您应当通过真实身份信息认证注册帐号，且您提交的帐号名称、头像、 简介等注册信息中不得出现违法和不良信息，经公司审核，如存在上述情况，宣铭将不予注册；同时，在注册后，如发现您以虚假信息骗取帐号名称注册，或其帐号头像、简介等注册信息存在违法和不良信息的，宣铭有权不经通知单方采取限期改正、暂停使用、注销登记、收回等措施。</p>
                    <p>3、您帐号包括帐户名称和密码，账户名称作为您有效的身份凭证之一。您可使用手机号和密码登录。</p>
                    <p>4、您不应将其帐号、密码转让、出售或出借予他人使用，若您授权他人使用帐户，应对被授权人在该帐户下发生所有行为负全部责任。由于您其他账户使用信息，仅当依法律法规、司法裁定或经宣铭同意，并符合宣铭规定的用户帐号转让流程的情况下，方可进行帐号的转让。</p>
                    <p>5、因您个人原因导致的帐号信息遗失，如需找回帐号信息，请按照帐号找回要求提供相应的信息，并确保提供的信息合法真实有效，若提供的信息不符合要求，无法通过安全验证，宣铭有权拒绝提供帐号找回服务；若帐号的唯一凭证不再有效，宣铭有权拒绝支持帐号找回。例如手机号二次出售，宣铭可拒绝支持帮助找回原手机号绑定的帐号。</p>
                    <p>6、在需要终止使用帐号服务时，符合以下条件的，您可以申请注销您的帐号：</p>
                    <p>（1）您仅能申请注销您本人的帐号，并依照宣铭的流程进行注销；</p>
                    <p>（2）您仍应对您在注销帐号前且使用的行为承担相应责任，同时宣铭仍可保存您注销前的相关信息；</p>
                    <p>（3）注销成功后，帐号信息、个人身份信息、交易记录、会员权益等将无法恢复或提供。</p>
                    <p>7、当您使用宣铭产品进行支付、登录等操作的时候，服务器会自动接收、验证、并记录一些必要的信息，如手机号码、IP地址、服务访问异常信息、以及部分设备信息等，以保障您在使用服务时账户登录和支付过程的安全，进而保护您的上网安全。您使用宣铭的服务，即表示您同意宣铭可以按照《隐私政策》处理您的个人信息。宣铭可能会与合作伙伴共同向您提供您所要求的服务或者共同向您展示您可能感兴趣的内容。在信息为该项产品/服务所必须的情况下，您同意宣铭可与其分享必要的信息。并且，宣铭会要求其确保数据安全并且禁止用于任何其他用途。除此之外，宣铭不会向任何无关第三方提供或分享信息。</p>
                    <p>8、您知悉并授权，宣铭仅在必需的情况下使用或与关联公司同步您的信息，以为您提供更好的服务。</p>
                    <p>9、为更好地向您铺提供服务，您同意宣铭通过短信、app通知等形式向您发送相关商业性服务信息。</p>
                    <p class="bh">三、使用规则</p>
                    <p>1、您在使用宣铭的服务时，必须遵守中华人民共和国相关法律法规的规定，您应同意将不会利用本服务进行任何违法或不正当的活动，包括但不限于下列行为:</p>
                    <p>（1）您设置的会员名或提供的信息不得含有下列内容之一的信息：</p>
                    <p>① 反对宪法所确定的基本原则的；</p>
                    <p>② 危害国家安全，泄露国家秘密，颠覆国家政权，破坏国家统一的；</p>
                    <p>③ 损害国家荣誉和利益的；</p>
                    <p>④ 煽动民族仇恨、民族歧视、破坏民族团结的；</p>
                    <p>⑤ 破坏国家宗教政策，宣扬邪教和封建迷信的；</p>
                    <p>⑥ 散布谣言，扰乱社会秩序，破坏社会稳定的；</p>
                    <p>⑦ 散布淫秽、色情、赌博、暴力、凶杀、恐怖或者教唆犯罪的；</p>
                    <p>⑧ 侮辱或者诽谤他人，侵害他人合法权利的；</p>
                    <p>⑨ 含有虚假、有害、胁迫、侵害他人隐私、骚扰、侵害、中伤、粗俗、猥亵、或其它道德上令人反感的内容；</p>
                    <p>⑩ 含有中国法律、法规、规章、条例以及任何具有法律效力之规范所限制或禁止的其它内容的；</p>
                    <p>（2）不得为任何非法目的而使用宣铭服务系统；</p>
                    <p>（3）不利用宣铭的服务从事以下活动：</p>
                    <p>① 未经允许，进入计算机信息网络或者使用计算机信息网络资源的；</p>
                    <p>② 未经允许，对计算机信息网络功能进行删除、修改或者增加的；</p>
                    <p>③ 未经允许，对进入计算机信息网络中存储、处理或者传输的数据和应用程序进行删除、修改或者增加的；</p>
                    <p>④ 故意制作、传播计算机病毒等破坏性程序的；</p>
                    <p>⑤ 其他危害计算机信息网络安全的行为。</p>
                    <p>2、您违反本协议或相关的服务条款的规定，导致或产生的任何第三方主张的任何索赔、要求或损失，包括合理的律师费，您同意赔偿宣铭与合作公司、关联公司，并使之免受损害。对此，宣铭有权视您的行为性质，采取包括但不限于删除您发布信息内容、暂停使用许可、终止服务、限制使用、回收帐号、追究法律责任等措施。对恶意注册帐号或利用帐号进行违法活动、捣乱、骚扰、欺骗、其他用户以及其他违反本协议的行为，宣铭有权回收其帐号。同时，宣铭会视司法部门的要求，协助调查。</p>
                    <p>3、您需要对自己在服务使用过程中的行为负法律责任，即使您已经终止使用该服务。您承担法律责任的形式包括但不限于：对受到侵害者进行赔偿，以及在宣铭首先承担了因您的行为导致的行政处罚或侵权损害赔偿责任后，您应给予宣铭等额的赔偿。</p>
                    <p>4、宣铭有权根据认定程序及标准判断您账户的使用可能危及您的账户安全及/或宣铭平台信息安全的，宣铭可拒绝提供相应服务或终止本协议。</p>
                    <p class="bh">四、服务内容</p>
                    <p>1、您在交易过程中与其他用户发生争议的，您或其他用户中任何一方可以自行协商解决，也可以通过宣铭介入处理，若您觉得以上的方式均无法达到您要的结果，您可以寻求司法机关的协助。</p>
                    <p>2、您选择宣铭介入的方式处理相关问题，那么您需要遵守和执行宣铭的处理结果。若您对宣铭的处理结果不满意，您可以寻求其他途径解决纠纷例如起诉、仲裁等方式，但在此之前您需先履行该结果。</p>
                    <p>3、宣铭目前为您提供免费提供服务，但宣铭保留因业务调整或者其他法律法规要求向您收取费用的权利。</p>
                    <p>4、宣铭网络服务的具体内容由宣铭根据实际情况提供。</p>
                    <p>5、鉴于网络服务的特殊性，您同意宣铭有权不经事先通知，随时变更、中断或终止部分或全部的网络服务（包括收费网络服务）。宣铭不担保网络服务不会中断，对网络服务的及时性、安全性、准确性也都不作担保。</p>
                    <p>6、您需遵守宣铭7天无理由退换货的相关规则。</p>
                    <p>7、终止服务</p>
                    <p>您同意宣铭得基于其自行之考虑，因任何理由，或宣铭认为您已经违反本服务协议的文字及精神，终止您的密码、帐号或本服务之使用（或服务之任何部分），并将您在本服务内任何内容加以移除并删除。您同意依本服务协议任何规定提供之本服务，无需进行事先通知即可中断或终止，您承认并同意，宣铭可立即关闭或删除您的帐号及您帐号中所有相关信息及文件，及/或禁止继续使用前述文件或本服务。此外，您同意若本服务之使用被中断或终止或您的帐号及相关信息和文件被关闭或删除，宣铭对您或任何第三人均不承担任何责任。</p>
                    <p class="bh">五、个人数据保护与授权</p>
                    <p>1、为了保护您的财产及信息安全，预防诈骗或者其他网络犯罪行为，宣铭有权收集您的个人信息，包括但不限于个人会员信息、交易信息来判断您个人的交易风险，对您身份进行验证等。</p>
                    <p>2、根据相关法律法规规定，以下情形中收集您的个人信息无需征得您的授权同意：</p>
                    <p>①、涉及公共安全，与重大利益相关的；</p>
                    <p>②、与政府部门包括司法机关等相关的；</p>
                    <p>③、出于保护您的个人财产或者利益的目的，但无法事先征求您同意的行为；</p>
                    <p>④、您以自行对外公开的，包括但不限于通过报纸、新闻等方式公开；</p>
                    <p>⑤、根据您的要求签订合同所必需的；</p>
                    <p>⑥、用于维护所提供的产品或服务的安全稳定运行所必需的，例如发现、处置产品或服务的故障；</p>
                    <p>⑦、国家法律法规政策认可或支持的相关行为；</p>
                    <p>3、我们已采取符合业界标准、合理可行的安全防护措施保护您提供的个人信息安全，防止个人信息遭到未经授权访问、公开披露、使用、修改、损坏或丢失。</p>
                    <p class="bh">六、免责声明</p>
                    <p>因以下情况造成网络服务在合理时间内的中断，宣铭无需为此承担任何责任；</p>
                    <p>（1）宣铭需要定期或不定期地对提供网络服务的平台或相关的设备进行检修或者维护，宣铭保留不经事先通知为维修保养、升级或其它目的暂停本服务任何部分的权利。</p>
                    <p>（2）因台风、地震、洪水、雷电或恐怖袭击等不可抗力原因；</p>
                    <p>（3）您的电脑软硬件和通信线路、供电线路出现故障的；</p>
                    <p>（4）因病毒、木马、恶意程序攻击、网络拥堵、系统不稳定、系统或设备故障、通讯故障、电力故障、银行原因、第三方服务瑕疵或政府行为等原因。尽管有前款约定，宣铭将采取合理行动积极促使服务恢复正常。</p>
                    <p class="bh">七、知识产权和其他合法权益</p>
                    <p>1、宣铭产品及相关网站上由宣铭上传、制作、拥有的所有内容，包括但不限于著作、图片、档案、资讯、资料、网站架构、网站画面的安排、网页设计，均由宣铭或其关联公司依法拥有其知识产权，包括但不限于商标权、专利权、著作权、商业秘密等。但如因您上传的由其自行制作、拥有的内容涉及侵犯宣铭或其他任何第三方的合法权益的，您应自行对其侵权行为产生的纠纷进行处理，并对其侵权行为承担法律责任，且就由此给宣铭造成的损失（包括但不限于宣铭声誉的影响、宣铭由此承担的连带责任（如有）等）进行赔偿。</p>
                    <p>2、非经宣铭或其关联公司书面同意，任何人不得擅自使用、修改、复制、公开传播、改变、散布、发行或公开发表在本网站上程序或内容（仅限于由宣铭上传、制作、拥有的所有内容，包括但不限于著作、图片、档案、资讯、资料、网站架构、网站画面的安排、网页设计等）；如您需使用著作权非宣铭所有的内容的，您应获得具体内容的著作权所有者的合法授权才能使用，如因您私自使用非自己所有的、且未经他人合法授权的著作、图片、档案、资讯、资料等内容的，由您自行承担责任，包括但不限于您自行对其侵权行为产生的纠纷进行处理，并对其侵权行为承担法律责任，且就由此给乙方造成的损失（包括但不限于乙方声誉的影响、乙方由此承担的连带责任（如有）等）进行赔偿。</p>
                    <p>3、尊重知识产权是您应尽的义务，如有违反，您应承担损害赔偿责任。</p>
                    <p class="bh">八、其他</p>
                    <p>1、本协议之效力、解释、变更、执行与争议解决均适用中华人民共和国法律，没有相关法律规定的，参照通用国际商业惯例和（或）行业惯例。</p>
                    <p>2、如本协议的任何条款被视作无效或无法执行，则上述条款可被分离，其余条款则仍具有法律效力。</p>
                    <p>3、本协议任何一方于另一方过失或违约时放弃本协议规定的权利的，不得视为其对一方的其他或以后同类之过失或违约行为弃权。</p>
                    <p>4、宣铭未行使或执行本服务协议任何权利或规定，不构成对前述权利或权利之放弃。</p>
                    <p>5、本协议最终解释权及修订权在法律范围内归宣铭所有。</p>
                </div>
            </div>
        </div>
    </div>
    <script src="__STATIC__/admin/common/js/vue.js"></script>
    <script src="__STATIC__/admin/common/js/vue-resource.js"></script>
    <script src="__STATIC__/admin/common/js/vue-router.js"></script>
    <script src="__STATIC__/admin/common/js/jquery.js"></script>
    <script src="https://cdn.bootcss.com/layer/2.3/layer.js"></script>
    <script src="__STATIC__/admin/common/laydate/laydate.js"></script>
    <script>

        var vm = new Vue({
            el: '#app',
            data: {
                showInviteCode: false,
                discountPrice: 0,
                protocolFlag: true,
                // selectData: [],
                gifFlag: -1,
                password: null,
                wayFlag: 1,
                showPayWay: false, //支付方式
                showVoucherPop: false, //上传凭证
                showProtocol: false, //协议内容
                orderInfo: [],  //订单信息
                addrData: [], // 收货地址数组
                addrSelectedIdx: 0, //被选中收货地址 索引
                addrSelectedId: 0, //收货地址 id
                accountMoney: 0, //用户账户余额,
                remittanceInfo: {
                    name: null,
                    account: null,
                    time: null
                },
                virtualTag: true,//显示隐藏收货地址  false: 虚拟商品  true:正常商品
                onlinePayImg: '', //微信、支付宝在线支付二维码路径
                onlinePayInterval: null, //在线支付 监听定时器
                year:'',
                inviteCode: '', //邀请码
                timer: null, 
                correctCode: false,
                inputCodeYet: false, //如果填写过邀请码 input框不可输入
                zzspBool: true, //增值商品过来 隐藏邀请码
                zzVir: true, //增值商品中的虚拟商品  不用显示收货地址
            },
            mounted: function(){
                // 从增值商品过来
                if(this.getCookie('zzsp_data')){
                    this.getServiceInfo();
                    this.zzspBool = false;
                }else{
                    this.getRemitTime(); //初始化日期选择
                    this.getOrderInfo()
                }
                // this.getCookie('TCid') ? : ; //套餐订单  增值服务商品信息
                this.getAllAddr(); // 收货地址
                this.getacountMoney(); //用户账户余额
                if(this.getCookie('virtual')){
                    this.virtualTag = JSON.parse(this.getCookie('virtual'));
                    this.delCookie('virtual');
                }
                this.year = this.getCookie('year');
            },
            methods: {
                // 查看协议
                showProtocolEvent: function(){
                    this.showProtocol = !this.showProtocol;
                },
                // 防抖
                debounce: function(fn,wait){
                    if (this.timer!==null){
                        clearTimeout(this.timer)
                    }
                    this.timer = setTimeout(fn,wait);
                },
                // 获取数据
                myAjax: function(url, param, callback){
                    this.$http.post(url, param).then(function(res){
                        callback(res);
                    }, function(res){
                        layer.msg(res.body.info, {time: 1000});
                    })
                },
                // 支付宝支付
                getAlipay: function(){
                    clearInterval(this.onlinePayInterval);
                    var param = {};
                    var url = '';
                    var _this = this;
                    var orderInfo = this.orderInfo[0];
                    if(!this.zzspBool){
                        url = 'analyse_code_alipay';
                        param = {
                            order_real_pay: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_amount: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_quantity: orderInfo.goods_quantity,
                            order_number: orderInfo.order_number,
                            goods_name: orderInfo.goods_name,
                            address_id: this.zzVir ? this.addrSelectedId : 0,
                            goods_franking: orderInfo.goods_franking ? orderInfo.goods_franking : 0
                        }
                    }else{
                        url = 'order_code_alipay';
                        param = {
                            money: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_number: orderInfo.order_number,
                            goods_name: orderInfo.goods_name,
                        }
                    }
                    this.myAjax(url, param, function(data){
                        console.log(111, data)
                        // 付款二维码生成成功， 监听支付
                        if(data.body.status == 1){
                            $('body').append(data.body.data.url);
                            // window.parent.document.getElementById('tcdl').click();
                        }
                    })
                },
                // 监听支付是否成功
                monitorOnlinePay: function(orderNum){
                    var param = {order_number: orderNum};
                    var _this = this;
                    var url = !this.zzspBool ? 'check_code_two' : 'check_code_one';
                    this.myAjax(url, param, function(data){
                        // console.log(data);
                        console.log(data.body.status)
                        if(data.body.status == 1){
                            layer.msg(data.body.info);
                            if(!_this.zzspBool){
                                location.href = 'store_order';
                            }else{
                                setTimeout(function(){
                                    clearInterval(_this.onlinePayInterval);
                                    _this.setCookie('item_id', '/admin/store_set_meal_order', 1);
                                    _this.setCookie('page_id', '219', 1);
                                    window.parent.document.getElementById('tcdl').click();
                                }, 3000)
                            }
                        }
                    })
                },
                // 获取微信支付二维码
                getWxCode: function(){
                    this.testAddr();
                    var _this = this;
                    var url = '';
                    var param = {};
                    var orderInfo = this.orderInfo[0];
                    // 增值商品
                    if(!this.zzspBool){
                        url = 'analyse_code_pay';
                        param = {
                            order_real_pay: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_amount: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_quantity: orderInfo.goods_quantity,
                            order_number: orderInfo.order_number,
                            goods_name: orderInfo.goods_name,
                            address_id: this.zzVir ? this.addrSelectedId : 0,
                            goods_franking: orderInfo.goods_franking ? orderInfo.goods_franking : 0
                        }
                    }else{
                        url = 'order_code_pay';
                        param = {
                            money: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_number: orderInfo.order_number,
                            goods_name: orderInfo.goods_name,
                        }
                    }
                    this.myAjax(url, param, function(data){
                        console.log(data)
                        // 付款二维码生成成功， 监听支付
                        if(data.body.status == 1){
                            _this.onlinePayImg = data.body.data.url;
                            // _this.onlinePayImg = JSON.parse(data.data.data);
                            _this.onlinePayInterval = setInterval(function(){
                                _this.monitorOnlinePay(param.order_number);
                            }, 2000)
                        }
                    })
                },
                // 选择汇款时间
                getRemitTime: function(){
                    var _this = this;
                    laydate.render({
                        elem: '#remitTime',
                        done: function(val){
                            _this.remittanceInfo.time = val;
                        }
                    });
                },
                // 获取用户余额
                getacountMoney: function(){
                    var _this = this;
                    _this.myAjax('store_wallet_return', '', function(data){
                        if(data.body.status == 1){
                            _this.accountMoney = data.body.data;
                        }
                    });
                },
                // 获取所有地址信息
                getAllAddr: function(){
                    var _this = this;
                    _this.myAjax('general_address_return_info', '', function(data){
                        if(data.body.status == 1){
                            _this.addrData = data.body.data;
                            _this.addrSelectedId = data.body.data[0].id;
                        }
                    });
                },
                // 获取套餐订单信息
                getOrderInfo: function(){
                    var param = {id: this.getCookie('TCid')};
                    var _this = this;
                    this.myAjax('order_package_buy', param, function(data){
                        console.log(data)
                        if(data.body.status == 1){
                            _this.orderInfo = data.body.data;
                            // 判断用户是否填写过邀请码
                            if(data.body.data[0].highe_share_code){
                                // _this.useDiscount();
                                _this.showInviteCode = true;
                                _this.inviteCode = data.body.data[0].highe_share_code;
                                _this.inputCodeYet = true;
                            }
                        }
                    });
                },
                // 增值商品
                getServiceInfo: function(){
                    this.$set(this.orderInfo, 0, JSON.parse(this.getCookie('zzsp_data')));
                    // 增值商品中的虚拟商品 不用显示收货地址
                    if(this.orderInfo[0].goods_type == 2){
                        this.zzVir = false;
                    }
                    console.log(this.orderInfo);
                },
                // get cookie
                getCookie: function(name){
                    var reg = RegExp(name + '=([^;]+)'),
                        arr = document.cookie.match(reg);
                    return arr ? arr[1] : '';
                },
                // set cookie
                setCookie: function(name, value, day){
                    var date = new Date();
                    date.setDate(date.getDate() + day);
                    document.cookie = name + '=' + value + ';expires=' + date;
                },
                //删除cookie
                delCookie: function(name) {
                    this.setCookie(name, null, -1);
                },
                // 转换时间戳
                timetrans: function(date){
                    var date = new Date(date*1000);//如果date为13位不需要乘1000
                    var Y = date.getFullYear() + '-';
                    var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
                    var D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate());
                    return Y+M+D;
                },
                // 管理地址
                toEditAddr: function(){
                    location.href = 'general_address?zzsp=1';
                },
                // 修改地址
                modifyAddr: function(){
                    alert('修改地址');
                },
                // 设置默认地址
                setDefaultAddr: function(id){
                    var param = {id: id};
                    this.myAjax('general_address_status', param, function(data){
                        if(data.body.status == 1){
                            location.reload();
                        }
                    });
                },
                // 选择收货地址
                selectAddr: function(i, id){
                    this.addrSelectedIdx = i;
                    this.addrSelectedId = id;
                },
                // 从增值商品过来  判断用户是否有收获地址
                testAddr: function(){
                    // if(this.orderInfo)
                    if(this.orderInfo[0].goods_type == 1 && this.addrSelectedId == 0){
                        if(confirm('您还未添加收获地址，是否立即前往添加？')){
                            location.href = 'general_address?zzsp=1';
                        }
                    }
                }, 
                // 减
                minusEvent: function(item){
                    item.goods_quantity > 1 ? item.goods_quantity-- : '';
                },
                // 加
                plusEvent: function(item){
                    if(item.goods_type != 2){
                        item.goods_quantity < item.stock ? '' : layer.msg('不得大于库存！', {time: 1000});
                    }
                    item.goods_quantity++;
                },
                // 选中商品
                // selectGoods: function(item, index, e){
                //     e.target.checked ? this.$set(this.selectData, index, item) : this.selectData.splice(index, 1);
                // },
                // 输入购买数量
                inputNumber: function(item, index){
                    var num = +this.$refs.num[index].value || 1;
                    if(item.goods_type != 2){
                        if(num > item.stock) layer.msg('不能大于库存！', {time: 1000});
                    }
                    this.$set(item, 'number', num > item.stock ? item.stock : (num < 0 ? 1 : num));
                },
                // 删除订单
                delEvent: function(orderNum){
                    if(confirm('您确定要删除该订单吗？')){
                        var param = {'order_number': orderNum};
                        this.myAjax('order_package_del', param, function(data){
                            if(data.body.status == 1){
                                layer.msg(data.body.info, {time: 1000});
                                setTimeout(function(){
                                    location.href = 'order_package_index';
                                }, 1100)
                            }
                        });
                    }
                },
                // 验证邀请码
                textInviteCode: function(){
                    var _this = this;
                    var param = {
                        code: this.inviteCode
                    }
                    this.myAjax('getShareCode', param, function(data){
                        console.log(data)
                        if(data.body.status == 1){
                            layer.msg(data.body.info);
                            _this.correctCode = true;
                            _this.discountPrice = data.body.data.share_money;
                        }else{
                            layer.msg(data.body.info);
                            _this.correctCode = false;
                        }
                    })
                },
                // 显示邀请码输入框
                useDiscount: function(){
                    if(this.inputCodeYet) return;
                    this.showInviteCode = !this.showInviteCode;
                },
                // 同意协议
                agreement: function(){
                    this.orderInfo.length?this.protocolFlag = !this.protocolFlag:'';
                },
                // 立即购买
                buy: function(){
                    this.showPayWay = true;
                    this.getWxCode(); //获取微信支付二维码
                },
                // 关闭支付弹窗
                closePop: function(){
                    clearInterval(this.onlinePayInterval);
                    this.showPayWay = false;
                },
                // 余额支付 闪烁光标
                inputPwd: function(e){
                    e.keyCode === 8 ? (this.gifFlag === 0 ? 0 : this.gifFlag -= 1) : (this.gifFlag === 6 ? 6 : this.gifFlag += 1);
                },
                // 选择支付方式
                changePayWay: function(index){
                    // 用户选择扫码支付（index==1) 执行获取二维码监听支付   否则清除监听
                    index == 1? this.getWxCode() : clearInterval(this.onlinePayInterval);
                    this.wayFlag = index;
                },
                // 余额支付确认密码
                comfirmPwd: function(){
                    var param = {
                        id: this.orderInfo[0].id,
                        password: this.password
                    }
                    var url = '';
                    var _this = this;
                    var orderInfo = this.orderInfo[0];
                    if(!this.zzspBool){
                        url = 'analyse_small_pay';
                        param = {
                            order_real_pay: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_amount: +(this.virtualTag ? this.payment : this.virtualPayment),
                            order_quantity: orderInfo.goods_quantity,
                            order_number: orderInfo.order_number,
                            goods_name: orderInfo.goods_name,
                            address_id: this.zzVir ? this.addrSelectedId : 0,
                            goods_franking: orderInfo.goods_franking ? orderInfo.goods_franking : 0,
                            password: this.password
                        }
                    }else{
                        url = 'order_package_balance';
                        param = {
                            id: orderInfo.id,
                            password: this.password,
                            pay_money: this.payment
                        }
                    }

                    _this.myAjax(url, param, function(data){
                        if(data.body.status == 1){
                            layer.alert('支付成功！', function(index){
                                // 增值商品过来 zzspBool为false
                                if(!this.zzspBool){
                                    location.href = 'store_order';
                                }else{
                                    layer.close(index);
                                    window.parent.document.getElementById('tcdl').click();
                                }
                            });
                        }else if(data.body.status == 2){
                            layer.alert('您还未设置支付密码，是否跳转去设置？', function(index){
                                layer.close(index);
                                location.href = 'security_setting';
                            });
                        }else{
                            layer.msg(data.body.info);
                        }
                    })
                },
                // 上传凭证
                uploadVoucher: function(){
                    this.showVoucherPop = true;
                    this.showPayWay = false;
                },
                // 上传凭证 确认
                voucherConfirm: function(){
                    var param = {
                        id: this.orderInfo[0].id,
                        money: this.payment,
                        remittance_name: this.remittanceInfo.name,
                        remittance_account: this.remittanceInfo.account,
                        pay_time: this.remittanceInfo.time
                    }
                    this.remittanceInfo.name ? 
                    (this.remittanceInfo.account ? 
                    (this.remittanceInfo.time ? 
                    this.myAjax('order_package_remittance', param, function(data){
                        console.log(data);
                        if(data.body.status == 1){
                            layer.alert('凭证已提交，我们将在3个工作日内审核完毕，通过后自动完成订购。', function(index){
                                layer.close(index);
                                //location.href = 'store_set_meal_order';
                                // location.href = '/admin';
                                window.parent.document.getElementById('tcdl').click();
                            });
                        }else{
                            layer.msg(data.body.info);
                        }
                    }) : 
                    layer.msg('请选择付款时间！')) : 
                    layer.msg('请填写付款账号！')) : 
                    layer.msg('请填写付款户名！');
                    
                },
                // 关闭 上传汇款凭证
                closeVoucher: function(){
                    this.showVoucherPop = false;
                    this.showPayWay = true;
                }
            },
            watch: {
                // 监听邀请码
                inviteCode: function(code){
                    var _this = this;
                    if (typeof code === 'string'){
                        if (code.trim().length !== 0){
                            this.debounce(this.textInviteCode, 500);
                        }else {}
                    }
                }
            },
            computed: {
                // 商品合计金额
                totalPrice: function(){
                    // if(this.selectData.length > 0){
                        // for(var i = 0, len = this.selectData.length; i < len; i++){
                            // if(this.selectData[i]){
                                // sum += this.selectData[0].goods_quantity * this.selectData[0].amount_money;
                            // }
                        // }
                    // }
                    // console.log(this.orderInfo)
                    var orderInfo = this.orderInfo[0];
                    if(this.orderInfo.length > 0){
                        return (this.orderInfo[0].goods_quantity * this.orderInfo[0].amount_money).toFixed(2);
                    }
                },
                // 最终付款金额
                payment: function(){
                    var sum = this.totalPrice;
                    if(this.correctCode){
                        return (sum - this.discountPrice).toFixed(2);
                    }else{
                        return sum;
                    }
                },
                // 虚拟商品 最终付款金额
                virtualPayment: function(){
                    var orderInfo = this.orderInfo[0];
                    if(orderInfo){
                        if(orderInfo.last_money == 0){
                            return (this.correctCode ? orderInfo.amount_money - this.discountPrice : orderInfo.amount_money).toFixed(2);
                        }else{
                            return (this.correctCode ? orderInfo.amount_money - orderInfo.last_money - this.discountPrice : orderInfo.amount_money - orderInfo.last_money).toFixed(2);
                        }
                    }
                },
                // 优惠 价格展示
                showDiscount: function(){
                    var orderInfo = this.orderInfo[0];
                    console.log(orderInfo);
                    if (orderInfo) {
                        if (this.correctCode) {
                            // 使用邀请码
                            // return (orderInfo.cost - orderInfo.amount_money + orderInfo.last_money + this.discountPrice).toFixed(2);
                            if(orderInfo.last_money != 0){
                                return '套餐优惠￥' + (orderInfo.cost - orderInfo.amount_money).toFixed(2) + '+' + '已订购套餐￥' + orderInfo.last_money.toFixed(2) + '+' + '邀请码￥' + this.discountPrice.toFixed(2);
                            }else{
                                return '套餐优惠￥' + (orderInfo.cost - orderInfo.amount_money).toFixed(2) + '+' + '邀请码￥' + this.discountPrice.toFixed(2);
                            }
                        } else {
                            // 未使用邀请码
                            // return (orderInfo.cost - orderInfo.amount_money + orderInfo.last_money).toFixed(2);
                            if(orderInfo.last_money != 0){
                                return '套餐优惠￥' + (orderInfo.cost - orderInfo.amount_money).toFixed(2) + '+' + '已订购套餐￥' + orderInfo.last_money.toFixed(2);
                            }else{
                                return '套餐优惠￥' + (orderInfo.cost - orderInfo.amount_money).toFixed(2);
                            }
                        }
                    }
                }
            }
        })
    </script>
</body>
</html>