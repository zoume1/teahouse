<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <title>增值订单</title>
</head>
<script src="https://cdn.bootcss.com/jquery/2.1.2/jquery.js"></script>
<script src="__STATIC__/admin/index/js/index.js"></script>
{block name="css"}
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/common/css/aaa.css" />
<link rel="stylesheet" href="__STATIC__/admin/common/layui/css/layui.css">
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/index/common/layui/css/layui.css" />

<style type="text/css">
    * {margin: 0;padding: 0;}
    body {background: #fff;}
    .wrapper {padding: 20px 10px;}
    .on {color: #21A5FA !important; border-bottom: solid 3px #21A5FA;}
    .distribution_list {margin-bottom: 10px; border-bottom: solid 1px #D7D7D7;}
    .distribution_list ul {display: flex; align-items: center; margin-bottom: 10px;}
    .distribution_list a {font-size: 14px; padding: 9px; color: #5E5E5E;}
    .search-hd{background-color: #f9f8f7; padding: 12px 0 12px 20px; margin-bottom: 10px; border-left: 5px solid #009688;}
    .search-box{display: flex; flex-wrap: wrap; font-size: 14px; color: #333;}
    .search-box input{border: 1px solid #e4e4e4; background-color: #fff; padding-left: 5px; width: 180px; height: 35px; box-sizing: border-box;}
    .search-box button{margin-left: 20px; height: 35px; line-height: 35px;}
    .search-box input::placeholder{color: #b2b2b2;}
    .search-box .layui-form-label{margin-bottom: 0;}
    .search-box label{float: left; display: block; margin-right: 10px; line-height: 38px;}
    .bot-operate{ width: 96%; height: 50px; line-height: 50px; border: solid 1px #e2e2e2; padding-left: 50px; background: #fdfdfd;}
    .bot-operate .opation{float: left}
    .bot-operate .opation select{color: #c1a5a5; border-color: #e4e4e4; height: 30px;}
    .bot-operate .operation-btn{width: 60px; background: #fff; color: #333; border:#ccc solid 1px; height: 30px; line-height: 30px; margin-left: 20px;}
    .btn-dfk{background-color: rgb(0, 102, 255)}
    .btn-dfh{background-color: rgb(204, 0, 204)}
    .btn-yfh{background-color: rgb(255, 0,0)}
    .btn-ywc{background-color: rgb(102, 153, 0)}
    .btn-ygb{background-color: rgb(161, 161, 161)}
    .btn-ytk{background-color: rgb(204, 153, 0)}
    .btn-yqx{background-color: rgb(131, 22, 38)}
    .line-exam{background-color: transparent; color: rgb(188, 188, 188); border: 1px solid rgb(188, 188, 188);}
    .line-ing{background-color: transparent; color: rgb(255, 153, 0); border: 1px solid rgb(255, 153, 0);}
    .line-pass{background-color: transparent; color: rgb(102, 153, 0); border: 1px solid rgb(102, 153, 0);}
    .table-cell {text-align: center;}
	.table-cell .dtl{color: rgb(0, 153, 255);}
    .table-cell-div{text-align:center;}
    .table-cell-div button{border-radius: 3px;}
    .mask{position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,.5); z-index: 9;}
    .pop{ position: absolute; top: 50%; left: 50%; margin: -183px 0 0 -325px; width: 680px; border: 1px solid #d6d6d6; background-color: #fff; z-index: 9; color: #333;}
    .pop .head{position: relative; padding-left: 16px; height: 35px; background-color: rgb(238, 247, 234); border-bottom: 1px solid #d6d6d6;}
    .pop .close{position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 26px; cursor: pointer;}
    .content{padding: 0 16px;}
    .top, .mid, .bot{padding: 0 20px;}
    .top{height: 50px; line-height: 50px; font-size: 13px;}
    .mid{border: 1px dashed #d2d2d2; border-left: 0; border-right: 0;}
    .mid h2{height: 60px; line-height: 60px; text-align: center; font-size: 20px; color: rgb(0, 153, 255);}
    .mid li{height: 50px; line-height: 50px; list-style: disc; font-size: 13px;}
    .mid li a.kf{color: rgb(102, 153, 0);}
    .bot{height: 65px; display: flex; align-items: center;}
    .bot>div{flex: 1;}
    #page {
        width: 97%;
		height: 50px;
		line-height: 50px;
		border: solid 1px #E2E2E2;
		padding-left: 50px;
		background: #FDFDFE;
    }


	.static_btus1 {
		width: 100px;
		height: 30px;
		line-height: 30px;
		text-align: center;
		cursor: pointer;
		margin-left: 10px
	}

	/* 没申请 */
	.not_apply {
		color: #BCBCBC;
		border: solid 1px #BCBCBC;
		border-radius: 3px;
	}

	/* 申请 */
	.apply {
		color: #FF9900;
		border: solid 1px #FF9900;
		border-radius: 3px;
	}

	/* 已开票
	 */
	.applyed {
		color: #669900;
		border: solid 1px #669900;
		border-radius: 3px;
	}

	.static_btus2 {
		width: 100px;
		height: 30px;
		line-height: 30px;
		color: #0099FF;
		cursor: pointer;
		text-align: center;
	}




	.line {
		justify-content: center;
	}



	.static_btus {
		border-radius: 5px;
	}



	/*
     * 弹窗
     4*/

	.popup {
		width: 100%;
		height: 100%;
		position: fixed;
		background: rgba(0, 0, 0, 0.5);
		z-index: 99999;
		display: flex;
		justify-content: center;
		align-items: center;
		border: solid 1px #D7D7D7;
		box-sizing: border-box;
	}

	.submit_btns {
		width: 100px;
		height: 38px;
		color: #fff;
		background: #169BD5;
		border-radius: 10px;
	}

	.popup_doms {
		width: 790px;
		height: 400px;
		background: #fff;
	}

	.popup_doms1 {
		width: 900px;
		background: #fff;
	}

	.popup_content {
		padding: 20px;
	}

	.popup_title {
		height: 40px;
		line-height: 40px;
		color: #66662B;
		background: #EEF7EA;
		padding-left: 20px;
		position: relative;
	}

	.span {
		display: inline-block;
		width: 80px;
		text-align: left;
		
	}

	.repany .layui-input {
		width: 530px;
	}

	.repany {
		margin-bottom: 10px;
		display: flex;
		align-items : center;
	}

	.operation {
		display: flex;
		align-items: center;
		justify-content: space-between;
	}

	.chat {
		height: 210px;
	}

	.danhao {
		width: 200px;
		margin-right: 10px;
	}

	.operation select {
		width: 130px;
		height: 40px;
		border-color: #ABADB3;
		color: #000;
		background: #fff;
	}

	.operation div {
		margin-right: 10px;
	}



	.noshow {
		display: none;
	}


	.popup_x {
		width: 25px;
		position: absolute;
		right: 12px;
		top: -4px;
	}

	.repay_tip {
		display: inline-block;
		width: 100px;
		height: 35px;
		text-align: center;
		line-height: 35px;
		color: #fff;
		background: #669900;
		border-radius: 5px;
	}





	/* .quxiao {} */

	.daying {
		background: rgb(22, 155, 213);
		color: #fff;
	}


	/*
     * 弹窗end
		 */


	.seach_button {
		border-radius: 4px;
		display: inline-block;
		width: 80px;
		line-height: 30px;
		color: #fff;
		text-align: center;
	}

	.all0 {
		background: #F4FBFF;
		color: #999;
	}

	.all1 {
		background: #CC3366;
	}

	.all2 {
		background: #CC00CC;
	}

	.all3 {
		background: #FF0000;
	}

	.all4 {
		background: #669900;
	}

	.all5 {
		background: #A1A1A1;
		color: #000;
	}

	/* 状态颜色 */
	/* 待付款 */
	.color1 {
		background: #CC3366;
	}

	/* 待发货 */
	.color2 {
		background: #CC00CC;
	}

	/* 已发货 */
	.color3 {
		background: #FF0000;
	}

	/* 已完成 */
	.color4 {
		background: #669900;
	}

	/* 已关闭 */
	.color5 {
		background: #A1A1A1;
	}

	/* 已退款 */
	.color6 {
		background: #CC9900;
	}

	/* 已入仓 */
	.color7 {
		background: #0000CC;
	}


	/*  待发货*/
	.color8 {
		background: #CC00CC;
	}

	/* 已取消 */
	.color9 {
		background: #831626;
	}

	.chenge_money {
		display: flex;
		margin-left: 10px;
		text-align: center;
		align-items : center;
		justify-content: space-between;
		padding-top: 20px;
		border-top: 2px dashed rgb(223, 223, 223)
	}

	.danwei {
		position: absolute;
		top: 10px;
		left: 170px;

	}

	td.three>div,
	td.four>div,
	td.five>div {
		border-bottom: 1px solid #e2e2e2;
	}

	td.four>div {
		line-height: 50px;
		white-space: nowrap;
		max-width: 450px;
		text-overflow: ellipsis;
		overflow: hidden;
	}

	td.three>div:last-of-type,
	td.four>div:last-of-type,
	td.five>div:last-of-type {
		border: 0;
	}

	td {
		padding: 4px 0 !important;
	}

	td img {
		width: 50px;
		height: 50px;
	}
	.Information {
		margin-right: 20px;
	}
	.logistics {font-size: 20px;margin-right:20px;font-weight:700;}


	

	
</style>


{/block}

<body>
{block name="content"}
<div class="popup popup_one noshow">
	<div class="popup_doms">
		<div class="popup_title">
			处理回复（个人信息处有提示信息）
			<div class="popup_x">
				<img style="width: 20px;" src="__STATIC__/admin/index/img/X.png" />
			</div>
		</div>
		<div class="popup_content">
			<div class="repany">
				<span class="span">官方批注</span>
				<input type="text" name="" lay-verify="title" autocomplete="off" placeholder="请输入处理备注"
					class="layui-input Information">
				<span class="repay_tip">批注</span>
			</div>
			<div class="chat"></div>
			<div class="operation"></div>
			<div class="chenge_money" data-id="">
				<div>
					<span class="logistics">物流</span>
					<span>顺丰：</span>
					<span>SF564564564654646</span>
				</div>
				
				<div style="margin-left:45px;">
					<button class="layui-btn confirmReceipt"
						style="background-color:rgb(22, 155, 213);border-radius: 5px;">确认收货</button>
				</div>
			</div>
		</div>
	</div>
</div>
    <div class="wrapper">
        {include file="template/_top" /}
        <div class="inner">
			<form class="layui-form" action="{:url('admin/General/store_order_search')}">
            <div class="search-hd">
                <div class="search-box layui-form">
                    <div>
                        <label>订单编号</label>
                        <input type="text" name="parts_order_number" class="layui-input">
                    </div>
                    <div class="date-input">
                        <label>下单时间</label>
                        <input type="text" data-type="date" name="start_time" id="searchDateStart">~
                        <input type="text" data-type="date" name="end_time" id="searchDateend">
                    </div>
                    <button class="layui-btn">搜索</button>
                </div>
			</div>
		</form>

            <div>
                <a href="{:url('admin/Analyse/analyse_order')}" class="layui-btn layui-btn-mini">全部</a>
                <a href="{:url('admin/Analyse/analyse_waiting')}" class="layui-btn layui-btn-mini btn-dfh">待发货</a>
                <a href="{:url('admin/Analyse/analyse_delivered')}" class="layui-btn layui-btn-mini btn-yfh">已发货</a>
                <a href="{:url('admin/Analyse/analyse_received')}" class="layui-btn layui-btn-mini btn-dfk">待收货</a>
                <a href="{:url('admin/Analyse/analyse_served')}" class="layui-btn layui-btn-mini btn-ytk">待服务</a>
                <a href="{:url('admin/Analyse/analyse_ok')}" class="layui-btn layui-btn-mini btn-yqx">待评价</a>
                <a href="{:url('admin/Analyse/analyse_ok')}" class="layui-btn layui-btn-mini btn-ywc">已完成</a>
            </div>
            <div class="layui-form news_list" >
                <table class="layui-table">
					
                    <thead>
                        <tr>
                            <th class="table-cell">
                                <input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose">
                            </th>
                            <th class="table-cell">
                                订单号
                            </th>
                            <th class="table-cell">
                                商品图片
                            </th>
                            <th class="table-cell">
                                产品名称
                            </th>
                            <th class="table-cell">
                                订单数量
                            </th>
                            <th class="table-cell">
                                下单时间
                            </th>
                            <th class="table-cell">
                                订单金额
                            </th>
                            <th class="table-cell">
                                支付类型
                            </th>
                            <th class="table-cell">
                                操作
                            </th>
                        </tr>
                    </thead>
                    <tbody class="news_content">
                            {if !empty($data)}
                            {volist name="data" id="vo"}
                        <tr>
                            <td class="table-cell">
                                    <input type="checkbox" name="singleChoose" lay-skin="primary" lay-filter="choose" data-id="{$vo.id}">
                            </td>
                            <td class="table-cell">
                                {$vo.parts_order_number}
                            </td>
                            <td class="table-cell">
                                    {if !empty($vo2["goods_image"])}
                                    <div><img src="__UPLOADS__/{$vo2.goods_image}" /></div>
                                    {else}
                                    <div>无</div>
                                    {/if}
                            </td>
                            <td class="table-cell">
                                {$vo.parts_goods_name}
                            </td>
                            <td class="table-cell">
                                {$vo.order_quantity}
                            </td>
                            <td class="table-cell">
                                {$vo.order_create_time|date="Y-m-d H:i:s",###}</div>
                            </td>
                            <td class="table-cell">
                                ￥{$vo.order_real_pay}
                            </td>
                            <td class="table-cell">
                                {$vo.si_pay_type|pay_types}
                            </td>
                            
                            <td class="table-cell">
                                <div class="table-cell-div " data-id="{$vo.parts_order_number}" data-values="{$vo.id}" data-orderStatus="{$vo.status}">
                                    {$vo.status|show_order_statues}
                                   <button class="layui-btn-mini line-exam">未申请开票</button>
                                    <a href="capital_management_details" class="dtl">订单详情</a>
                                </div>
                            </td>
                        </tr>
                        {/volist}
                        {/if}
                    </tbody>
                </table>
            </div>
            <div class="bot-operate" id="page">
                <div class="opation">
                    <select>
                        <option check="" value="0">请选择</option>
                        <option value="1">批量删除</option>
                    </select>
                </div>
                <div>
                    <button type="button" id="operation-btn" class="operation-btn">确定</button>
                </div>
            </div>
            {if !empty($data)}
            {$data->render()}
            {/if}
        </div>
    </div>

    <div class="mask" style="display: none;"></div>
   
{/block}


<!--请在下方写此页面业务相关的脚本-->
{block name="bottom"}
<script src="__STATIC__/admin/common/layui/layui.js"></script>
<script>
    layui.use(['laydate', 'form'], function(){
        var laydate = layui.laydate,
            form = layui.form;
        $('input[data-type="date"]').each(function(idx, elem){
            laydate.render({
                elem: elem
            })
        })
		// $(".static_btus").click(function () {
		// 	$(".popup_one").removeClass("noshow");
		// })
		$(".static_btus").click(function () {
			var _this = this;
			var data_id = $(this).parent().data("id");    //订单号
			var order_num = $(this).parent().data("values"); //订单id
			var order_status = $(this).parent().data("orderstatus");    //订单状态
			$(".repay_tip").data("values", order_num);
			$(".repay_tip").data("id", data_id);
			$(".operation").empty();
			$(".chat").empty();
			//获取批注
			$.ajax({
				type: "POST",
				url: "{:url('admin/Analyse/store_notice_index')}",
				data: {
					"order_id": data_id,
					"order_num": order_num,
				},
				async: false,
				success: function (data) {
					var data = JSON.parse(data);
					way = data.data.order_type;   //邮寄方式    
					$(".chenge_money").empty();
					for (var i = 0; i < data.data.datas.length; i++) {
						var dhtm0 = "";
						dhtm0 += '<div class="chat_list">';
						dhtm0 += '	<span class="span">' + timestampToTime(data.data.datas[i].create_time) + '</span>';
						dhtm0 += '<span>' + data.data.datas[i].information + '</span>';
						dhtm0 += '</div>';
						$(".chat").append(dhtm0);
					}
					let dhtml = '',dhtml1 = '',btn = '',class_btn = '';
					if(order_status == '3' || order_status == '4') {
						if(data.data.goods_type == 1) {
							btn = '确认收货';
						} 
						class_btn = 'confirmReceipt';
					} else if(order_status == 7) {
						btn = '追加评价';
						class_btn = 'toComments';
					} else if(order_status == 12) {
						btn = '确认服务';
						class_btn = 'confirmReceipt';
					}else if (order_status=='8'){
						btn = '申请售后';
						class_btn = 'afterSale';

					}
					
					dhtml = `
						<div>
							<span class="logistics">物流</span>
							<span>${data.data.express_name}：</span>
							<span>${data.data.courier_number}</span>
						</div>
						<div style="margin-left:45px;">
							<button class="layui-btn ${class_btn}" data-id="${data_id}"
								style="background-color:rgb(22, 155, 213);border-radius: 5px;">${btn}</button>
						</div>`;
					dhtml1 = `
						<div>	
						</div>
						<div style="margin-left:45px;">
							<button class="layui-btn ${class_btn}" data-id="${data_id}"
								style="background-color:rgb(22, 155, 213);border-radius: 5px;">${btn}</button>
						</div>`;


					if(data.data.goods_type == 1) {
						
						$(".chenge_money").append(dhtml);
					} else {
						$(".chenge_money").append(dhtml1);
					}
					//跳转评论页
					$(".toComments").click(function() {
						window.location.href = '/admin/additional_comments/data-id/'+data_id;
					})
					//跳转售后
					$(".afterSale").click(function() {
						window.location.href = '/admin/adder_after_sale/adder_order_id/'+order_num;
					})
					//确认收货/服务
					$('.confirmReceipt').click(function () {
						var order_id = $(this).data('id');
						$.ajax({
								type: "POST",
								url: "{:url('admin/Analyse/store_confirm_status')}",
								data: {
									"order_id": data_id,
									"status": 7,
								},
								async: false,
								success: function (data) {
									var data = JSON.parse(data);
									if(data.status == 1) {
										alert(data.info)
									} else {
										alert(data.info)
									}
									$(".popup_one").addClass("noshow");
									location.reload();
								},
								error: function (data) {

								}
							});
					});

				},
				error: function (data) {

				}
			});
			
			
			$(".popup_one").removeClass("noshow");

			
		});
		//弹窗隐藏
		$(".popup_x").click(function () {
			$(".popup").addClass("noshow");
		});
		

		// 点击批注
		$(".repay_tip").click(function () {
			var data_id = $(this).data("values");     //订单id
			var order_num = $(this).data("id");       //订单编号
			var Information = $(".Information").val();
			if (Information != '') {
				$.ajax({
					type: "POST",
					url: "{:url('admin/Notification/option_add_notice')}",
					data: {
						"order_id": data_id,
						"information": Information,
						"order_num": order_num,
					},
					async: false,
					success: function (data) {
						var data = eval('(' + data + ')');
						var dhtm0 = "";
						dhtm0 += '<div class="chat_list">';
						dhtm0 += '	<span class="span">' + timestampToTime(data.data.create_time) + '</span>';
						dhtm0 += '<span>' + data.data.information + '</span>';
						dhtm0 += '</div>';
						$(".chat").append(dhtm0);
						$(".Information").val("");

					},
					error: function (data) {

					}
				});

			}
			else {
				alert("批注不能为空");
			}
		});
		function timestampToTime(timestamp) {
			var date = new Date(timestamp * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
			Y = date.getFullYear();
			M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1);
			D = date.getDate();
			h = date.getHours() + ':';
			m = date.getMinutes() + ':';
			s = date.getSeconds();
			return Y + M + D;
		}
        form.render();
    })
</script>
{/block}
